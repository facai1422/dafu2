function changeTabsDeed(a){switch(a){case 0:_loadPage(".tab-content",ctx+"/deedManage/dailyWageDeed","","","","",4,a);break;case 1:_loadPage(".tab-content",ctx+"/deedManage/dailyWageRecord","","","","",4,a);break;case 2:_loadPage(".tab-content",ctx+"/deedManage/bonusDeedNew","","","","",4,a);break;case 3:_loadPage(".tab-content",ctx+"/deedManage/bonusRecordNew","","","","",4,a);break;case 4:_loadPage(".tab-content",ctx+"/deedManage/dailyWageDeedNew","","","","",4,a);break;case 5:_loadPage(".tab-content",ctx+"/deedManage/dailyWageRecordNew","","","","",4,a);break;case 6:_loadPage(".tab-content",ctx+"/deedManage/dailyWageThreeRecord_","","","","",4,a);break;case 7:_loadPage(".tab-content",ctx+"/deedManage/institutionalReport","","","","",4,a);break;case 8:_loadPage(".tab-content",ctx+"/deedManage/dailyWageReport","","","","",4,a);break;default:break}}function getTime(f,b,a){var e=new Date();var g;g=e.getFullYear()+"-"+((e.getMonth()+1)<10?("0"+(e.getMonth()+1)):(e.getMonth()+1))+"-"+(e.getDate()<10?("0"+e.getDate()):e.getDate());var c=new Date(e);c.setDate(e.getDate());var d;d=c.getFullYear()+"-"+((c.getMonth()+1)<10?("0"+(c.getMonth()+1)):(c.getMonth()+1))+"-01";if(a){$("#"+f).val(g);$("#"+b).val(g)}else{$("#"+f).val(d);$("#"+b).val(g)}$("#"+f).click(function(){WdatePicker({dateFmt:"yyyy-MM-dd",readOnly:true,isShowClear:false,minDate:"%y-{%M-3}-{%d+1}",maxDate:"#F{$dp.$D('"+b+"')}"})});$("#"+b).click(function(){var h=$("#"+f).val();WdatePicker({dateFmt:"yyyy-MM-dd",readOnly:true,isShowClear:false,minDate:h,maxDate:"%y-%M-%d"})})}function addLine(c){var a=$(c).parent().parent().index();if(!checkMax(c,a)){return}$(c).remove();var b=$("#table1");var d="<tr>";d+='<td><input type="text" maxlength="9" value="0" class="form-control" onchange="checkInt(this.value);" onkeyup="this.value=this.value.replace(/\\D/g,\'\')" onafterpaste="this.value=this.value.replace(/\\D/g,\'\')" ></td>';d+='<td><input type="text" maxlength="9" value="0" class="form-control" onchange="checkInt(this.value);" onkeyup="this.value=this.value.replace(/\\D/g,\'\')" onafterpaste="this.value=this.value.replace(/\\D/g,\'\')" ></td>';d+='<td><input type="text" maxlength="4" value="0" class="form-control" onchange="checkInt(this.value);" onkeyup="this.value=this.value.replace(/\\D/g,\'\')" onafterpaste="this.value=this.value.replace(/\\D/g,\'\')" ></td>';d+='<td><input type="text" maxlength="5" class="form-control" onkeyup="checknum(this)"></td>';d+='<td><a onclick="delLine(this);">删除</a>&nbsp;&nbsp;<a onclick="addLine(this);">添加行</a></td>';$(b).append(d)}function checkMax(f,e){var b=$(f).parent().parent().find("td:eq(0)").find("input").val();var h=$(f).parent().parent().find("td:eq(1)").find("input").val();var c=$(f).parent().parent().find("td:eq(2)").find("input").val();if(checkInt(b)&&checkInt(h)){if(parseInt(b)>999999999){_confirm("warning",0,"","存在错误信息，无法添加新行");return false}if(parseInt(h)>999999999){_confirm("warning",0,"","存在错误信息，无法添加新行");return false}if(parseInt(c)>1000){_confirm("warning",0,"","存在错误信息，无法添加新行");return false}if(e>0){var d=$("#table1").find("tr:eq("+e+")").find("td:eq(0)").find("input").val();var g=$("#table1").find("tr:eq("+e+")").find("td:eq(1)").find("input").val();var a=$("#table1").find("tr:eq("+e+")").find("td:eq(2)").find("input").val();if(parseInt(b)<parseInt(d)||parseInt(h)<parseInt(g)||parseInt(c)<parseInt(a)){_confirm("warning",0,"","存在错误信息，无法添加新行");return false}else{return true}}else{return true}}else{return false}}function checkInt(b){var a=/^((0)|([1-9][0-9]*))$/;if(!a.test(b)){_confirm("warning",0,"","请输入正确的格式");return false}return true}function delLine(a){$(a).parent().parent().remove();var c=$("#table1").find("tr").length;var b=$("#table1 tr:last td:last");if(c-1>1){b.html("<a onclick='delLine(this);'>删除</a>&nbsp;&nbsp;<a onclick='addLine(this);'>添加行</a>")}else{b.html("<a onclick='addLine(this);'>添加行</a>")}}var myState_bonusDeed;function searchBonusTable(c){var d={};d.UserName=$("#userName").val();d.CurrentPageSize=10;d.CurrentPageIndex=c;var a=ctx+"/deedManage/getBonusContract";var b={message:json2str(d)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,b,function(f){$("#bonusTable").empty();var e="<tr>";if(f.SystemState==64){myState_bonusDeed=f.State;if(f.State==-1){$("#mybonusDeed").hide()}else{$("#mybonusDeed").show();if(f.State==0){_confirm("warning",1,"","有契约哦！",getMybonusDeed);$(".modal-content").find(".btn-ok").text("现在去签")}}if(f.LockState==1){$("#myOneKeySettlement").show()}else{$("#myOneKeySettlement").hide()}$("#updateTime").html(f.UpdateDateTime);if(f.ContractManagerModels.length>0){$.each(f.ContractManagerModels,function(g,h){e+="<td>"+h.UserName+"</td>";e+="<td>"+h.Rebate+"</td>";e+="<td>"+getState(h.State)+"</td>";e+="<td>";if(h.State>=0){e+='<a class="cp" data-toggle="modal" data-target="#myBonus_editer" onclick="getMyDownContract('+myUserID+","+h.UserID+',this,2);">修改契约</a>'}else{e+='<a class="cp" data-toggle="modal" data-target="#myBonus_editer" onclick="getMyDownContract('+myUserID+","+h.UserID+',this,1);">签订契约</a>'}if(f.LockState==1&&h.State>=0){e+='<a class="cp" data-toggle="modal" data-target="#myBonus_05" onclick="getDividendSettlement('+h.UserID+',this);">分红结算</a>'}e+="</td></tr>"})}}$("#bonusTable").html(e);$.page(c,f.DataCount,"",4);hide_bet_loadding()},"json")}function getState(b){var a="";if(b==0){a="待确认"}else{if(b==1){a="已签约"}else{if(b==2){a="已拒绝"}else{a="未签约"}}}return a}function getDividendSettlement(b,f){var d=$(f).parent().parent().find("td:eq(0)").text();var e={};e.UserID=b;$("#_id").val(b);$("#_uname").val(d);$("#_name1").html(d);$("#_name2").html(d);var a=ctx+"/deedManage/getDividendSettlement";var c={message:json2str(e)};$.post(a,c,function(j){$("#_bonus1").empty();$("#_bonus2").empty();var h="<tr>";var i="<tr>";if(j.SystemState==64){$("#dividendCycle").html(j.DividendCycle);if(j.GetDividendContractList.length>0){$.each(j.GetDividendContractList,function(k,l){h+="<td>"+l.Expenditure+"</td>";h+="<td>"+l.LossAmount+"</td>";h+="<td>"+l.ActivePeopleNum+"</td>";h+="<td>"+accMul(parseFloat(l.DividendRatio),100)+"%</td>";h+="</tr>"})}else{h+="<td colspan='4'>无记录</td></tr>"}if(j.GetBonusPreviewModels!=""){var g=j.GetBonusPreviewModels;i+="<td>"+g.TotalBets+"</td>";i+="<td>"+g.GrossProfit+"</td>";i+="<td>"+g.ActivePeopleNum+"</td>";i+="<td>"+accMul(parseFloat(g.DividendRatio),100)+"%</td>";i+="</tr>";i+='<tr><td colspan="4">应得分红：<span style="color: #FF0000;" id="deservedDividend">'+Math.abs(g.DeservedDividend)+"</span></td></tr>"}else{i+="<td colspan='4'>无记录</td></tr>"}}else{h+="<td colspan='4'>无记录</td></tr>";i+="<td colspan='4'>无记录</td></tr>"}$("#_bonus1").html(h);$("#_bonus2").html(i)},"json")}function bonusSettlement(){var c={};c.DownUserId=$("#_id").val();c.DownUserName=$("#_uname").val();var a=ctx+"/deedManage/bonusSettlement";var b={message:json2str(c)};$.post(a,b,function(e){if(e.Result>0){_confirm("success",0,"","结算成功",_callBack,_callBack)}else{if(e.Result==-1){_confirm("error",0,"","分红周期已分过分红",_callBack,_callBack)}else{if(e.Result==-2){_confirm("error",0,"","上级是自己，不能自己分红",_callBack,_callBack)}else{if(e.Result==-3){_confirm("error",0,"","余额不足 不能分红",_callBack,_callBack)}else{if(e.Result==-4){_confirm("error",0,"","该用户已结算",_callBack,_callBack)}else{_confirm("error",0,"","结算失败",_callBack,_callBack)}}}}}},"json")}function getMybonusDeed(){$("#myBonus_detail").modal("show");var c={};c.UserID=myUserID;c.IsState=myState_bonusDeed;var a=ctx+"/deedManage/getMyBonusDeed";var b={message:json2str(c)};$.post(a,b,function(f){$("#myBonusDeedTable").empty();$("#myBonusDeedTable_update").empty();var e="<tr>";var g="<tr>";if(f.SystemState==64){if(f.ContractContentModels.length>0){$.each(f.ContractContentModels,function(d,h){if(h.IsHistoryData==0){e+="<td>"+h.BetMoneyMin+"</td>";e+="<td>"+h.LossMoneyMin+"</td>";e+="<td>"+h.ActivePersonNum+"</td>";e+="<td>"+accMul(parseFloat(h.DividendRatio),100)+"%</td>";e+="</tr>"}else{g+="<td>"+h.BetMoneyMin+"</td>";g+="<td>"+h.LossMoneyMin+"</td>";g+="<td>"+h.ActivePersonNum+"</td>";g+="<td>"+accMul(parseFloat(h.DividendRatio),100)+"%</td>";g+="</tr>"}})}else{e+="<td colspan='4'>无记录</td></tr>";g+="<td colspan='4'>无记录</td></tr>"}}else{e+="<td colspan='4'>无记录</td></tr>";g+="<td colspan='4'>无记录</td></tr>"}if(myState_bonusDeed==1){$("#updateTip").hide();$("#agreeBtnDiv").hide();g+="<td colspan='4'>无记录</td></tr>";$(".myBonus").hide();$("#myBonus_afterTable").hide()}else{$("#updateTip").show();$("#agreeBtnDiv").show()}$("#myBonusDeedTable").html(e);$("#myBonusDeedTable_update").html(g)},"json")}function agreeBonusDeed(c){var f={};f.UserID=myUserID;f.IsAgree=c;var b=ctx+"/deedManage/agreeBonusDeed";var e={message:json2str(f)};var a="";var d="";if(c==1){a="您的契约已经变更，下次分红将按照新的契约执行";d="变更失败"}else{a="您已拒绝了上级的契约修改";d="拒绝失败"}$("#agreeBonus_btn").hide();$.post(b,e,function(g){if(g.Result){_confirm("success",0,"",a,_callBack,_callBack)}else{_confirm("error",0,"",d,_callBack,_callBack)}},"json")}function getMyDownContract(b,h,g,c){var e=$(g).parent().parent().find("td:eq(0)").text();var f={};f.UserID=b;f.DownUserId=h;var a=ctx+"/deedManage/getMyDownContract";var d={message:json2str(f)};$.post(a,d,function(l){$("#myBonusTable").empty();var j="";var k="";if(l.MyContract.length>0){$.each(l.MyContract,function(m,n){j+="<tr>";j+="<td>"+n.BetMoneyMin+"</td>";j+="<td>"+n.LossMoneyMin+"</td>";j+="<td>"+n.ActivePersonNum+"</td>";j+="<td>"+accMul(parseFloat(n.DividendRatio),100)+"%</td>";j+="</tr>"})}else{j+="<tr><td colspan='4'>无记录</td></tr>"}$("#myBonusTable").html(j);if(l.DownContract.length>0){$.each(l.DownContract,function(m,n){k+="<tr>";k+="<td><input type='text' maxlength='9' value="+n.BetMoneyMin+" class='form-control' onchange='checkInt(this.value);' onkeyup=\"this.value=this.value.replace(/\\D/g,'')\" onafterpaste=\"this.value=this.value.replace(/\\D/g,'')\" ></td>";k+="<td><input type='text' maxlength='9' value="+n.LossMoneyMin+" class='form-control' onchange='checkInt(this.value);' onkeyup=\"this.value=this.value.replace(/\\D/g,'')\" onafterpaste=\"this.value=this.value.replace(/\\D/g,'')\" ></td>";k+="<td><input type='text' maxlength='4' value="+n.ActivePersonNum+" class='form-control' onchange='checkInt(this.value);' onkeyup=\"this.value=this.value.replace(/\\D/g,'')\" onafterpaste=\"this.value=this.value.replace(/\\D/g,'')\" ></td>";k+="<td><input type='text' maxlength='5' value="+accMul(parseFloat(n.DividendRatio),100)+" class='form-control' onkeyup='checknum(this)'></td>";k+="<td>";if(m>0){k+="<a onclick='delLine(this);' >删除</a>&nbsp;&nbsp;"}if(m==l.DownContract.length-1){k+="<a onclick='addLine(this);'>添加行</a>"}k+="</td></tr>"})}else{k+="<tr>";k+="<td><input type='text' value='0' maxlength='9' class='form-control' onchange='checkInt(this.value);' onkeyup=\"this.value=this.value.replace(/\\D/g,'')\" onafterpaste=\"this.value=this.value.replace(/\\D/g,'')\" ></td>";k+="<td><input type='text' value='0' maxlength='9' class='form-control' onchange='checkInt(this.value);' onkeyup=\"this.value=this.value.replace(/\\D/g,'')\" onafterpaste=\"this.value=this.value.replace(/\\D/g,'')\" ></td>";k+="<td><input type='text' value='0' maxlength='4' class='form-control' onchange='checkInt(this.value);' onkeyup=\"this.value=this.value.replace(/\\D/g,'')\" onafterpaste=\"this.value=this.value.replace(/\\D/g,'')\" ></td>";k+="<td><input type='text' maxlength='5' class='form-control' onkeyup='checknum(this)'></td>";k+="<td><a onclick='addLine(this);'>添加行</a></td>";k+="</tr>"}$("#_lines").html(k);$("#childrenName").html(e);$("#childrenID").val(h);var i="";if(c==1){i="<button type='button' class='btn btn-primary' onclick='addBonus();'>保存</button>"}else{i="<button type='button' class='btn btn-primary' onclick='updateBonus();'>保存</button>"}$("#btnDiv").html(i)},"json")}function addBonus(){var e={};e.UserName=$("#childrenName").html();e.UserID=$("#childrenID").val();e.ContractContentModels=[];var j=$("#_lines").children("tr");for(var f=0;f<j.length;f++){var b={};b.BetMoneyMin=$(j[f]).children("td:eq(0)").find("input").val();b.LossMoneyMin=$(j[f]).children("td:eq(1)").find("input").val();b.ActivePersonNum=$(j[f]).children("td:eq(2)").find("input").val();if(parseInt(b.BetMoneyMin)>999999999){_confirm("warning",0,"","消费额范围为0-999999999");return false}if(parseInt(b.LossMoneyMin)>999999999){_confirm("warning",0,"","亏损额范围为0-999999999");return false}if(parseInt(b.ActivePersonNum)>1000){_confirm("warning",0,"","活跃人数范围为0-1000");return false}if(f==j.length-1){b.BetMoneyMax=999999999;b.LossMoneyMax=999999999}else{b.BetMoneyMax=$(j[f+1]).children("td:eq(0)").find("input").val();b.LossMoneyMax=$(j[f+1]).children("td:eq(1)").find("input").val();var h=$(j[f+1]).children("td:eq(2)").find("input").val();if(parseInt(b.BetMoneyMin)>parseInt(b.BetMoneyMax)||parseInt(b.LossMoneyMin)>parseInt(b.LossMoneyMax)||parseInt(b.ActivePersonNum)>parseInt(h)){_confirm("warning",0,"","存在错误信息");return}if(parseInt(b.BetMoneyMax)>999999999){_confirm("warning",0,"","消费额范围为0-999999999");return false}if(parseInt(b.LossMoneyMax)>999999999){_confirm("warning",0,"","亏损额范围为0-999999999");return false}if(parseInt(b._actNum)>1000){_confirm("warning",0,"","活跃人数范围为0-1000");return false}}b.ActivePersonNum=$(j[f]).children("td:eq(2)").find("input").val();var g=$(j[f]).children("td:eq(3)").find("input").val();var c=/^[0-9]+(.[0-9]{0,2})?$/;if(""==g||null==g){_confirm("warning",0,"","分红比例不能为空");return}else{if(!(c.test(g))){_confirm("warning",0,"","输入有误,比例范围为0.01%-100%");return}else{if(parseFloat(g)>100||parseFloat(g)<0.01){_confirm("warning",0,"","输入有误,比例范围为0.01%-100%");return}}}b.DividendRatio=accDiv(parseFloat(g),100);e.ContractContentModels.push(b)}var a=ctx+"/deedManage/addBonusContract";var d={message:json2str(e)};$.post(a,d,function(i){if(i.Result>0){_confirm("success",0,"","添加成功",_callBack,_callBack)}else{if(i.Result==-1){_confirm("error",0,"","用户不存在")}else{if(i.Result==-2){_confirm("error",0,"","不能添加会员")}else{if(i.Result==-3){_confirm("error",0,"","该代理已添加分红契约")}else{if(i.Result==-4){_confirm("error",0,"","级别超过限制")}else{if(i.Result==-5){_confirm("error",0,"","您尚未签约，不能与下级签约！")}else{_confirm("error",0,"","添加失败")}}}}}}},"json")}function updateBonus(){var f={};f.UserName=$("#childrenName").html();f.UserID=$("#childrenID").val();f.ContractContentModels=[];var j=$("#_lines").children("tr");for(var g=0;g<j.length;g++){var c={};c.BetMoneyMin=$(j[g]).children("td:eq(0)").find("input").val();c.LossMoneyMin=$(j[g]).children("td:eq(1)").find("input").val();c.ActivePersonNum=$(j[g]).children("td:eq(2)").find("input").val();if(parseInt(c.BetMoneyMin)>999999999){_confirm("warning",0,"","消费额范围为0-999999999");return false}if(parseInt(c.LossMoneyMin)>999999999){_confirm("warning",0,"","亏损额范围为0-999999999");return false}if(parseInt(c.ActivePersonNum)>1000){_confirm("warning",0,"","活跃人数范围为0-1000");return false}if(g==j.length-1){c.BetMoneyMax=999999999;c.LossMoneyMax=999999999}else{c.BetMoneyMax=$(j[g+1]).children("td:eq(0)").find("input").val();c.LossMoneyMax=$(j[g+1]).children("td:eq(1)").find("input").val();var b=$(j[g+1]).children("td:eq(2)").find("input").val();if(parseInt(c.BetMoneyMin)>parseInt(c.BetMoneyMax)||parseInt(c.LossMoneyMin)>parseInt(c.LossMoneyMax)||parseInt(c.ActivePersonNum)>parseInt(b)){_confirm("warning",0,"","存在错误信息");return}if(parseInt(c.BetMoneyMax)>999999999){_confirm("warning",0,"","消费额范围为0-999999999");return false}if(parseInt(c.LossMoneyMax)>999999999){_confirm("warning",0,"","亏损额范围为0-999999999");return false}if(parseInt(c._actNum)>1000){_confirm("warning",0,"","活跃人数范围为0-1000");return false}}c.ActivePersonNum=$(j[g]).children("td:eq(2)").find("input").val();var h=$(j[g]).children("td:eq(3)").find("input").val();var d=/^[0-9]+(.[0-9]{0,2})?$/;if(""==h||null==h){_confirm("warning",0,"","分红比例不能为空");return}else{if(!(d.test(h))){_confirm("warning",0,"","输入有误,比例范围为0.01%-100%");return}else{if(parseFloat(h)>100||parseFloat(h)<0.01){_confirm("warning",0,"","输入有误,比例范围为0.01%-100%");return}}}c.DividendRatio=accDiv(parseFloat(h),100);f.ContractContentModels.push(c)}var a=ctx+"/deedManage/modifyBonusContractContent";var e={message:json2str(f)};$.post(a,e,function(i){if(i.Result){_confirm("success",0,"","保存成功",_callBack,_callBack)}else{_confirm("error",0,"","保存失败",_callBack,_callBack)}},"json")}function _callBack(){$("#myBonus_editer").modal("hide");$("#myBonus_detail").modal("hide");$("#myBonus_05").modal("hide");searchBonusTable($(".page .active").text()-1)}function searchBonusRecord(){searchChildrenTable(0);searchSelfTable(0)}function searchSelfTable(c){var d={};d.IsSelf=0;d.BeginTime=$("#starttime").val()+" 00:00:00";d.EndTime=$("#endtime").val()+" 23:59:59";d.CurrentPageSize=5;d.CurrentPageIndex=c;var a=ctx+"/deedManage/getDividentsList";var b={message:json2str(d)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,b,function(f){$("#selfTable").find("tr:gt(0)").remove();var e="<tr>";if(f.SystemState==64){if(null!=f.DividentsDetailAllList&&f.DividentsDetailAllList.length>0){$.each(f.DividentsDetailAllList,function(g,h){e+="<td>"+h.UserName+"</td>";e+="<td>"+h.TotalBatMoney+"</td>";e+="<td>"+h.TotalProfitLossMoney+"</td>";e+="<td>"+h.ActivePersonNum+"</td>";e+="<td>"+accMul(parseFloat(h.DividendRatio),100)+"%</td>";e+="<td>"+h.DividentMoney+"</td>";e+="<td>"+h.CreateTime+"</td>";e+="</tr>"})}}$("#selfTable").append(e);$.page(c,f.DataCount,"selfTable",7,5);hide_bet_loadding()},"json")}function searchChildrenTable(c){var d={};d.UserName=$("#userName").val();d.IsSelf=1;d.BeginTime=$("#starttime").val()+" 00:00:00";d.EndTime=$("#endtime").val()+" 23:59:59";d.CurrentPageSize=5;d.CurrentPageIndex=c;var a=ctx+"/deedManage/getDividentsList";var b={message:json2str(d)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,b,function(e){$("#childrenTable").find("tr:gt(0)").remove();var f="<tr>";if(e.SystemState==64){if(null!=e.DividentsDetailAllList&&e.DividentsDetailAllList.length>0){$.each(e.DividentsDetailAllList,function(g,h){f+="<td>"+h.UserName+"</td>";f+="<td>"+h.TotalBatMoney+"</td>";f+="<td>"+h.TotalProfitLossMoney+"</td>";f+="<td>"+h.ActivePersonNum+"</td>";f+="<td>"+accMul(parseFloat(h.DividendRatio),100)+"%</td>";f+="<td>"+h.DividentMoney+"</td>";f+="<td>"+h.CreateTime+"</td>";f+="</tr>"})}}$("#childrenTable").append(f);$.page(c,e.DataCount,"childrenTable",7,5);hide_bet_loadding()},"json")}function oneKeySettlement(){var c={};c.Sign=1;var a=ctx+"/deedManage/oneKeySettlement";var b={message:json2str(c)};$.post(a,b,function(e){if(e.StateBool){_confirm("success",0,"","结算成功",function(){searchBonusTable(0)},function(){searchBonusTable(0)})}else{_confirm("error",0,"","结算失败",function(){searchBonusTable(0)},function(){searchBonusTable(0)})}},"json")}var myState_DailyWageDeed;function searchDailyWageTable(c){var d={};d.UserName=$("#userName").val();d.DayWagesState=$("#dayWagesState").val();d.CurrentPageSize=10;d.CurrentPageIndex=c;var a=ctx+"/deedManage/getDayWagesList";var b={message:json2str(d)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,b,function(f){$("#dailyWageTable").empty();var e="<tr>";if(f.SystemState==64){myState_DailyWageDeed=f.State;if(f.State==-1){$("#myDailyWageDeed").hide()}else{$("#myDailyWageDeed").show();if(f.State==0){_confirm("warning",1,"","有契约哦！",getMyDailyWageDeed);$(".modal-content").find(".btn-ok").text("现在去签")}}if(f.DayWagesListModels.length>0){$.each(f.DayWagesListModels,function(g,h){e+="<td>"+h.UserName+"</td>";e+="<td>"+h.Rebate+"</td>";e+="<td>"+h.ActivePersonNum+"</td>";e+="<td>"+h.StandardMoney+"</td>";e+="<td>"+getState_dailywage(h.State)+"</td>";e+="<td>";if(h.State==0||h.State==1){e+='<a class="cp" data-toggle="modal" data-target="#myDailyWage_editer" onclick="getMyDownDayWages('+myUserID+","+h.UserID+',this,2);">修改契约</a>'}else{e+='<a class="cp" data-toggle="modal" data-target="#myDailyWage_editer" onclick="getMyDownDayWages('+myUserID+","+h.UserID+',this,1);">签订契约</a>'}e+="</td></tr>"})}else{e+="<td colspan='6'>无记录</td></tr>"}}else{e+="<td colspan='6'>无记录</td></tr>"}$("#dailyWageTable").html(e);$.page(c,f.DataCount,"",6);hide_bet_loadding()},"json")}function getMyDailyWageDeed(){$("#myDailyWage_detail").modal("show");var c={};c.UserID=myUserID;var a=ctx+"/deedManage/getDayWagesDetails";var b={message:json2str(c)};$.post(a,b,function(f){$("#myDailyWageDeedTable").empty();$("#myDailyWageDeedTable_update").empty();var e="<tr>";var g="<tr>";if(f.SystemState==64){$("#myActNum_before").html(f.OldActivePersonNum);$("#standMoney_before").html(f.OldStandardMoney);$("#myActNum_after").html(f.NewActivePersonNum);$("#standMoney_after").html(f.NewStandardMoney);if(f.RewardProportion_OldDataModels.length>0){$.each(f.RewardProportion_OldDataModels,function(d,h){if(h.RewardType==1){e+="<td>"+h.BetMoneyMin+"≤消费额<"+h.BetMoneyMax+"</td>";e+="<td>"+accMul(parseFloat(h.RewardProportion),100)+"%</td>";e+="</tr>"}})}else{e+="<td colspan='2'>无记录</td></tr>"}if(f.RewardProportion_NewDataModels.length>0){$.each(f.RewardProportion_NewDataModels,function(d,h){if(h.RewardType==1){g+="<td>"+h.BetMoneyMin+"≤消费额<"+h.BetMoneyMax+"</td>";g+="<td>"+accMul(parseFloat(h.RewardProportion),100)+"%</td>";g+="</tr>"}})}else{g+="<td colspan='2'>无记录</td></tr>"}}else{e+="<td colspan='2'>无记录</td></tr>";g+="<td colspan='2'>无记录</td></tr>"}if(myState_DailyWageDeed!=0){$("#updateTip").hide();$("#agreeBtnDiv").hide();$(".myDaily").hide();$("#updateDiv").hide()}else{$("#updateTime").html(f.EditTime);$("#updateTip").show();$("#agreeBtnDiv").show()}$("#myDailyWageDeedTable").html(e);$("#myDailyWageDeedTable_update").html(g)},"json")}function getMyDownDayWages(c,g,h,b){$("#activePersonNum").val(0);$("#standardMoney").val(0);$("#betMoneyMin").val(0);$("#betMoneyMax").val(999999999);$("#rewardProportion").val("");var e=$(h).parent().parent().find("td:eq(0)").text();var f={};f.SubordinateUserid=g;f.UserID=c;var a=ctx+"/deedManage/getMyDownDayWages";var d={message:json2str(f)};$.post(a,d,function(l){$("#myActNum").html(l.ActivePersonNum);$("#myStand").html(l.StandardMoney);$("#myDailyWageTable").empty();var j="";if(l.MyDayWages.length>0){$.each(l.MyDayWages,function(m,n){if(n.RewardType==1){j+="<tr>";j+="<td>"+n.BetMoneyMin+"≤消费额<"+n.BetMoneyMax+"</td>";j+="<td>"+accMul(parseFloat(n.RewardProportion),100)+"%</td>";j+="</tr>"}})}else{j+="<tr><td colspan='2'>无记录</td></tr>"}$("#myDailyWageTable").html(j);if(l.SubordinateDayWages.length>0){var k=l.SubordinateDayWages[0];$("#activePersonNum").val(k.ActivePersonNum);$("#standardMoney").val(k.StandardMoney);$("#betMoneyMin").val(k.BetMoneyMin);$("#betMoneyMax").val(k.BetMoneyMax);$("#rewardProportion").val(accMul(parseFloat(k.RewardProportion),100))}$("#childrenName").html(e);$("#childrenID").val(g);var i="";if(b==1){i="<button type='button' class='btn btn-primary' onclick='addDayWages();'>保存</button>"}else{i="<button type='button' class='btn btn-primary' onclick='modifyDayWages();'>保存</button>"}$("#btnDiv").html(i)},"json")}function agreeDayWages(c){var f={};f.UserID=myUserID;f.UserName=personObj.UserName;f.IsAgree=c;var b=ctx+"/deedManage/agreeDayWages";var e={message:json2str(f)};var a="";var d="";if(c==1){a="您的契约已经变更，下次将按照新的契约执行";d="变更失败"}else{a="您已拒绝了上级的契约修改";d="拒绝失败"}$.post(b,e,function(g){if(g.Result){_confirm("success",0,"",a,dailyWage_callBack,dailyWage_callBack)}else{_confirm("error",0,"",d,dailyWage_callBack,dailyWage_callBack)}},"json")}function dailyWage_callBack(){$("#myDailyWage_editer").modal("hide");$("#myDailyWage_detail").modal("hide");searchDailyWageTable(0)}function addDayWages(){var f={};f.UserName=$("#childrenName").html();f.ActivePersonNum=$("#activePersonNum").val();f.StandardMoney=$("#standardMoney").val();f.StatisticalMethod=1;if(f.ActivePersonNum==""){_confirm("warning",0,"","活跃人数不能为空");return false}else{if(f.ActivePersonNum>1000){_confirm("warning",0,"","活跃人数范围为0-1000");return false}}if(f.StandardMoney==""){_confirm("warning",0,"","达标流水不能为空");return false}else{if(f.StandardMoney>100000){_confirm("warning",0,"","达标流水范围为0-100000");return false}}f.RewardProportionModels=[];var c={};c.BetMoneyMin=$("#betMoneyMin").val();c.BetMoneyMax=$("#betMoneyMax").val();c.LossMoneyMin=0;c.LossMoneyMax=0;c.ActivePersonNum=$("#activePersonNum").val();c.StandardMoney=$("#standardMoney").val();var b=$("#rewardProportion").val();if(parseInt(c.BetMoneyMin)>999999999){_confirm("warning",0,"","消费额范围为0-999999999");return false}if(parseInt(c.BetMoneyMax)>999999999){_confirm("warning",0,"","消费额范围为0-999999999");return false}if(parseInt(c.BetMoneyMin)>parseInt(c.BetMoneyMax)){_confirm("warning",0,"","数据有误");return false}var d=/^[0-1]+(.[0-9]{0,3})?$/;if(""==b||null==b){_confirm("warning",0,"","比例不能为空");return}else{if(!(d.test(b))){_confirm("warning",0,"","输入有误,比例范围为0.001%-1%");return}else{if(parseFloat(b)>1||parseFloat(b)<0.001){_confirm("warning",0,"","输入有误,比例范围为0.001%-1%");return}}}c.RewardProportion=accDiv(parseFloat(b),100);c.RewardType=1;f.RewardProportionModels.push(c);var a=ctx+"/deedManage/addDayWages";var e={message:json2str(f)};$.post(a,e,function(g){if(g.Result>0){_confirm("success",0,"","添加成功",dailyWage_callBack,dailyWage_callBack)}else{if(g.Result==-1){_confirm("error",0,"","用户不存在")}else{if(g.Result==-2){_confirm("error",0,"","不能添加会员")}else{if(g.Result==-3){_confirm("error",0,"","该代理已添加日结契约")}else{if(g.Result==-4){_confirm("error",0,"","级别超过限制")}else{if(g.Result==-5){_confirm("error",0,"",g.Msg)}else{if(g.Result==0){_confirm("error",0,"",g.Msg)}else{if(g.Result==-6){_confirm("error",0,"","您尚未签约，不能与下级签约！")}else{_confirm("error",0,"","添加失败")}}}}}}}}},"json")}function modifyDayWages(){var f={};f.UserName=$("#childrenName").html();f.UserID=$("#childrenID").val();f.ActivePersonNum=$("#activePersonNum").val();f.StandardMoney=$("#standardMoney").val();f.StatisticalMethod=1;if(f.ActivePersonNum==""){_confirm("warning",0,"","活跃人数不能为空");return false}else{if(f.ActivePersonNum>1000){_confirm("warning",0,"","活跃人数范围为0-1000");return false}}if(f.StandardMoney==""){_confirm("warning",0,"","达标流水不能为空");return false}else{if(f.StandardMoney>100000){_confirm("warning",0,"","达标流水范围为0-100000");return false}}f.RewardProportionModels=[];var c={};c.BetMoneyMin=$("#betMoneyMin").val();c.BetMoneyMax=$("#betMoneyMax").val();c.LossMoneyMin=0;c.LossMoneyMax=0;c.ActivePersonNum=$("#activePersonNum").val();c.StandardMoney=$("#standardMoney").val();var b=$("#rewardProportion").val();if(parseInt(c.BetMoneyMin)>999999999){_confirm("warning",0,"","消费额范围为0-999999999");return false}if(parseInt(c.BetMoneyMax)>999999999){_confirm("warning",0,"","消费额范围为0-999999999");return false}if(parseInt(c.BetMoneyMin)>parseInt(c.BetMoneyMax)){_confirm("warning",0,"","数据有误");return false}var d=/^[0-1]+(.[0-9]{0,3})?$/;if(""==b||null==b){_confirm("warning",0,"","比例不能为空");return}else{if(!(d.test(b))){_confirm("warning",0,"","输入有误,比例范围为0.001%-1%");return}else{if(parseFloat(b)>1||parseFloat(b)<0.001){_confirm("warning",0,"","输入有误,比例范围为0.001%-1%");return}}}c.RewardProportion=accDiv(parseFloat(b),100);c.RewardType=1;f.RewardProportionModels.push(c);var a=ctx+"/deedManage/modifyDayWages";var e={message:json2str(f)};$.post(a,e,function(g){if(g.Result){_confirm("success",0,"","修改成功",dailyWage_callBack,dailyWage_callBack)}else{if(g.Msg!="1"){_confirm("error",0,"",g.Msg)}else{_confirm("error",0,"","修改失败")}}},"json")}function searchSelfTable_dailyWage(c){var d={};d.IsSelf=0;d.BeginTime=$("#starttime").val()+" 00:00:00";d.EndTime=$("#endtime").val()+" 23:59:59";d.CurrentPageSize=5;d.CurrentPageIndex=c;d.IsHistory=false;if($("#selectTime").val()==0){d.IsHistory=true}var a=ctx+"/deedManage/getDayWagesRecordsList";var b={message:json2str(d)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,b,function(f){$("#selfTable_dailyWage").find("tr:gt(0)").remove();var e="<tr>";if(f.SystemState==64){if(f.GetWayWagesList.length>0){$.each(f.GetWayWagesList,function(g,h){e+="<td>"+h.User_Name+"</td>";e+="<td>"+dailyWageType(h.DetailSource)+"</td>";e+="<td>"+h.BettingAmount+"</td>";e+="<td>"+h.LossAmount+"</td>";e+="<td>"+accMul(parseFloat(h.DayWagesRatio),100)+"%</td>";e+="<td>"+dailyWageTypeForMoney(h.DetailSource,h.DayWagesAmount)+"</td>";e+="<td>"+h.CreateTime+"</td>";e+="</tr>"})}}$("#selfTable_dailyWage").append(e);$.page(c,f.DataCount,"selfTable_dailyWage",7,5);hide_bet_loadding()},"json")}function searchChildrenTable_dailyWage(c){var d={};d.User_Name=$("#userName").val();d.UserID=personObj.MyUserID;d.IsSelf=1;d.BeginTime=$("#starttime").val()+" 00:00:00";d.EndTime=$("#endtime").val()+" 23:59:59";d.CurrentPageSize=5;d.CurrentPageIndex=c;d.IsHistory=false;if($("#selectTime").val()==0){d.IsHistory=true}var a=ctx+"/deedManage/getDayWagesRecordsList";var b={message:json2str(d)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,b,function(e){$("#childrenTable_dailyWage").next().hide();$("#childrenTable_dailyWage").find("tr:gt(0)").remove();var f="<tr>";if(e.SystemState==64){if(e.GetWayWagesList.length>0){$("#childrenTable_dailyWage").next().show();$.each(e.GetWayWagesList,function(g,h){f+="<td>"+h.User_Name+"</td>";f+="<td>"+dailyWageType(h.DetailSource)+"</td>";f+="<td>"+h.BettingAmount+"</td>";f+="<td>"+h.LossAmount+"</td>";f+="<td>"+accMul(parseFloat(h.DayWagesRatio),100)+"%</td>";f+="<td>"+dailyWageTypeForMoney(h.DetailSource,h.DayWagesAmount)+"</td>";f+="<td>"+h.CreateTime+"</td>";f+="</tr>"})}}$("#childrenTable_dailyWage").append(f);$.page(c,e.DataCount,"childrenTable_dailyWage",7,5);hide_bet_loadding()},"json")}function dailyWageTypeForMoney(b,a){if(b=="266"||b=="264"){return"-"+a}return a}function dailyWageType(b){var a="";if(b=="263"){a="来自上级的日结"}else{if(b=="264"){a="发给下级的日结"}else{if(b=="265"){a="人工添加日结"}else{if(b=="266"){a="人工扣除日结"}else{if(b=="301"){a="消费日结"}else{if(b=="302"){a="亏损日结"}}}}}}return a}function searchDailyWageRecord(){searchChildrenTable_dailyWage(0);searchSelfTable_dailyWage(0)}function getState_dailywage(b){var a="";if(b==0){a="待确认"}else{if(b==1){a="已签约"}else{if(b==3){a="已拒绝"}else{a="未签约"}}}return a}var myState_DailyWageThree;function searchDailyWageThreeTable(c){var d={};d.UserName=$("#userName").val();d.DayWagesState=$("#dayWagesState").val();d.CurrentPageSize=10;d.CurrentPageIndex=c;var a=ctx+"/deedManage/getDayWagesThreeList";var b={message:json2str(d)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,b,function(f){$("#dailyWageThreeTable").empty();var e="<tr>";if(f.SystemState==64){myState_DailyWageThree=f.State;if(f.State==-1){$("#myDailyWageThreeDeed").hide()}else{$("#myDailyWageThreeDeed").show();if(f.State==0){_confirm("warning",1,"","有契约哦！",getMyDailyWageThreeDeed);$(".modal-content").find(".btn-ok").text("现在去签")}}if(f.DayWagesThreeListModels.length>0){$.each(f.DayWagesThreeListModels,function(g,h){e+="<td>"+h.UserName+"</td>";e+="<td>"+h.Rebate+"</td>";e+="<td>"+h.DayWageStandard+"</td>";e+="<td>"+getState_dailywage(h.State)+"</td>";e+="<td>";if(h.State==0||h.State==1){e+='<a class="cp" data-toggle="modal" data-target="#myDailyWageThree_editer" onclick="getMyDownDayWagesThree('+myUserID+","+h.UserID+","+h.State+',this,2);">修改契约</a>'}else{e+='<a class="cp" data-toggle="modal" data-target="#myDailyWageThree_editer" onclick="getMyDownDayWagesThree('+myUserID+","+h.UserID+","+h.State+',this,1);">签订契约</a>'}e+="</td></tr>"})}else{e+="<td colspan='5'>无记录</td></tr>"}}else{e+="<td colspan='5'>无记录</td></tr>"}$("#dailyWageThreeTable").html(e);$.page(c,f.DataCount,"",5);hide_bet_loadding()},"json")}function getMyDailyWageThreeDeed(){$("#myDailyWageThree_detail").modal("show");var c={};c.UserID=myUserID;var a=ctx+"/deedManage/initDayWagesThreeData";var b={message:json2str(c)};$.post(a,b,function(g){$("#myDailyWageThreeTable").empty();$("#myDailyWageThreeTable_update").empty();$("#mydailyWage_ruleTable").empty();var e="<tr>",h="<tr>",f="<tr>";if(g.SystemState==64){if(null!=g.Before_DayWagesRules&&g.Before_DayWagesRules.length>0){$.each(g.Before_DayWagesRules,function(d,j){e+="<td>"+j.DayWageStandard+"</td>";e+="<td>"+j.DaySales+"</td>";e+="<td>"+j.ActiveNumber+"</td>";e+="</tr>"});if(null!=g.InitDayWagesRules&&g.InitDayWagesRules.length>0){$.each(g.InitDayWagesRules,function(d,j){if(j.DayWagesProportion<=g.Before_DayWagesRules[0].DayWagesProportion){f+='<td width="35%">'+j.DayWageStandard+"</td>";f+='<td width="30%">'+j.DaySales+"</td>";f+='<td width="35%">'+j.ActiveNumber+"</td>";f+="</tr>"}})}else{f+="<td colspan='3'>无记录</td></tr>"}}else{e+="<td colspan='3'>无记录</td></tr>";f+="<td colspan='3'>无记录</td></tr>"}if(null!=g.After_DayWagesRules&&g.After_DayWagesRules.length>0){$.each(g.After_DayWagesRules,function(d,j){h+="<td>"+j.DayWageStandard+"</td>";h+="<td>"+j.DaySales+"</td>";h+="<td>"+j.ActiveNumber+"</td>";h+="</tr>"})}else{h+="<td colspan='3'>无记录</td></tr>"}}else{e+="<td colspan='3'>无记录</td></tr>";h+="<td colspan='3'>无记录</td></tr>"}if(myState_DailyWageThree!=0){$("#updateTip").hide();$("#agreeBtnDivThree").hide();$(".myDaily").hide();$("#updateDiv").hide()}else{$("#updateTime").html(g.EditTime);$("#updateTip").show();$("#agreeBtnDivThree").show()}$("#myDailyWageThreeTable").html(e);$("#myDailyWageThreeTable_update").html(h);$("#mydailyWage_ruleTable").html(f)},"json")}function getMyDownDayWagesThree(d,e,a,c,h){var i=$(c).parent().parent().find("td:eq(0)").text();var g={};g.SubordinateUserid=e;g.UserID=d;var b=ctx+"/deedManage/getMyDownDayWagesThree";var f={message:json2str(g)};$.post(b,f,function(p){$("#myDailyWageThree").empty();$("#childrenDaily").html(0);var m,k;var o=p.MaxdDayWagesProportion;if(null!=p.MyDayWagesThree&&p.MyDayWagesThree.length>0){m=p.MyDayWagesThree[0].DayWagesProportion;$("#myDailyWageThree").html(p.MyDayWagesThree[0].DayWageStandard)}$("#childrenName").html(i);$("#childrenID").val(e);if(null!=p.SubordinateDayWagesThree&&p.SubordinateDayWagesThree.length>0){k=p.SubordinateDayWagesThree[0].DayWagesProportion;$("#childrenDaily").html(p.SubordinateDayWagesThree[0].DayWageStandard)}var l="<option value=''>请选择新的日结契约</option>";var n="";if(null!=p.InitDayWagesRules&&p.InitDayWagesRules.length>0){$.each(p.InitDayWagesRules,function(q,r){if(h==1){if(r.DayWagesProportion>=o&&r.DayWagesProportion<=m){l+="<option value="+r.ID+">"+r.DayWageStandard+"</option>"}}else{if(r.DayWagesProportion>k&&r.DayWagesProportion<=m){l+="<option value="+r.ID+">"+r.DayWageStandard+"</option>"}}if(r.DayWagesProportion<=m){n+="<tr><td width='35%'>"+r.DayWageStandard+"</td><td width='30%'>"+r.DaySales+"</td><td width='35%'>"+r.ActiveNumber+"</td></tr>"}})}$("#dailyWageRule").html(l);$("#dailyWageRuleTable").html(n);var j="";if(h==1){j="<button type='button' class='btn btn-primary' onclick='addDayWagesThree();'>保存</button>"}else{j="<button type='button' class='btn btn-primary' onclick='modifyDayWagesThree();'>保存</button>"}$("#btnDivThree").html(j);if(a==0){$("#dqr").show();$("#superiorUserDayWages").html(p.SuperiorDayWageStandard);$("#dailyWageRule").hide();$("#btnDivThree").hide()}else{$("#dqr").hide();$("#dailyWageRule").show();$("#btnDivThree").show()}},"json")}function addDayWagesThree(){var c={};c.UserName=$("#childrenName").html();c.ID=$("#dailyWageRule").val();if(c.ID==""){_confirm("warning",0,"","请选择日结契约");return}var a=ctx+"/deedManage/addDayWagesThree";var b={message:json2str(c)};$.post(a,b,function(e){if(e.Result>0){_confirm("success",0,"","添加成功",dailyWageThree_callBack,dailyWageThree_callBack)}else{if(e.Result==-1){_confirm("error",0,"","用户不存在")}else{if(e.Result==-2){_confirm("error",0,"","不能添加会员")}else{if(e.Result==-3){_confirm("error",0,"","该代理已添加日结契约")}else{if(e.Result==-4){_confirm("error",0,"","级别超过限制")}else{if(e.Result==-5){_confirm("error",0,"","该用户是非顶级代理")}else{if(e.Result==-6){_confirm("error",0,"","该用户上级无日结契约，不能添加！")}else{_confirm("error",0,"","添加失败")}}}}}}}},"json")}function modifyDayWagesThree(){var c={};c.UserName=$("#childrenName").html();c.ModifyId=$("#dailyWageRule").val();c.UserID=$("#childrenID").val();if(c.ModifyId==""){_confirm("warning",1,"","请选择新的日结契约");return}var a=ctx+"/deedManage/modifyDayWagesThree";var b={message:json2str(c)};$.post(a,b,function(e){if(e.Result){_confirm("success",0,"","修改成功",dailyWageThree_callBack,dailyWageThree_callBack)}else{_confirm("error",0,"","修改失败")}},"json")}function agreeDayWagesThree(b){var d={};d.UserID=myUserID;d.UserName=personObj.UserName;d.IsAgree=b;var a=ctx+"/deedManage/agreeDayWagesThree";var c={message:json2str(d)};$("#agreeDayWages_btn").hide();$.post(a,c,function(e){if(e.Result){_confirm("success",0,"","您的契约已经变更，下次将按照新的契约执行",dailyWageThree_callBack,dailyWageThree_callBack)}else{_confirm("error",0,"","变更失败",dailyWageThree_callBack,dailyWageThree_callBack)}},"json")}function dailyWageThree_callBack(){$("#myDailyWageThree_editer").modal("hide");$("#myDailyWageThree_detail").modal("hide");searchDailyWageThreeTable(0)}function searchDailyWageThreeRecord(){searchChildrenTable_dailyWageThree(0);searchSelfTable_dailyWageThree(0)}function searchSelfTable_dailyWageThree(c){var d={};d.IsSelf=0;d.BeginTime=$("#starttime").val()+" 00:00:00";d.EndTime=$("#endtime").val()+" 23:59:59";d.CurrentPageSize=5;d.CurrentPageIndex=c;d.IsHistory=false;if($("#selectTime").val()==0){d.IsHistory=true}var a=ctx+"/deedManage/getDayWagesRecord";var b={message:json2str(d)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,b,function(f){$("#selfTable_dailyWageThree").find("tr:gt(0)").remove();var e="<tr>";if(f.SystemState==64){if(null!=f.GetWayWagesList&&f.GetWayWagesList.length>0){$.each(f.GetWayWagesList,function(g,h){e+="<td>"+h.User_Name+"</td>";e+="<td>"+dailyWageType(h.DetailSource)+"</td>";e+="<td>"+h.SalesVolume+"</td>";e+="<td>"+h.ActivePersonNum+"</td>";if(h.Reserve1!=""&&h.Reserve1!=null){e+="<td>"+h.Reserve1+"</td>"}else{e+="<td>"+accMul(parseFloat(h.DayWagesRatio),100)+"%</td>"}e+="<td>"+dailyWageTypeForMoney(h.DetailSource,h.DayWagesAmount)+"</td>";e+="<td>"+h.CreateTime+"</td>";e+="</tr>"})}}$("#selfTable_dailyWageThree").append(e);$.page(c,f.DataCount,"selfTable_dailyWageThree",7,5);hide_bet_loadding()},"json")}function searchChildrenTable_dailyWageThree(c){var d={};d.User_Name=$("#userName").val();d.UserID=personObj.MyUserID;d.IsSelf=1;d.BeginTime=$("#starttime").val()+" 00:00:00";d.EndTime=$("#endtime").val()+" 23:59:59";d.CurrentPageSize=5;d.CurrentPageIndex=c;d.IsHistory=false;if($("#selectTime").val()==0){d.IsHistory=true}var a=ctx+"/deedManage/getDayWagesRecord";var b={message:json2str(d)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,b,function(e){$("#childrenTable_dailyWageThree").next().hide();$("#childrenTable_dailyWageThree").find("tr:gt(0)").remove();var f="<tr>";if(e.SystemState==64){if(null!=e.GetWayWagesList&&e.GetWayWagesList.length>0){$("#childrenTable_dailyWageThree").next().show();$.each(e.GetWayWagesList,function(g,h){f+="<td>"+h.User_Name+"</td>";f+="<td>"+dailyWageType(h.DetailSource)+"</td>";f+="<td>"+h.SalesVolume+"</td>";f+="<td>"+h.ActivePersonNum+"</td>";if(h.Reserve1!=""&&h.Reserve1!=null){f+="<td>"+h.Reserve1+"</td>"}else{f+="<td>"+accMul(parseFloat(h.DayWagesRatio),100)+"%</td>"}f+="<td>"+dailyWageTypeForMoney(h.DetailSource,h.DayWagesAmount)+"</td>";f+="<td>"+h.CreateTime+"</td>";f+="</tr>"})}}$("#childrenTable_dailyWageThree").append(f);$.page(c,e.DataCount,"childrenTable_dailyWageThree",7,5);hide_bet_loadding()},"json")}function searchLess_dailyWageThree(c){var d={};d.IsSelf=0;d.BeginTime=$("#starttime").val()+" 00:00:00";d.EndTime=$("#endtime").val()+" 23:59:59";d.CurrentPageSize=5;d.CurrentPageIndex=c;d.ProvideTyp=302;d.IsHistory=false;if($("#selectTime").val()==0){d.IsHistory=true}var a=ctx+"/deedManage/getDayWagesRecord";var b={message:json2str(d)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,b,function(f){$("#searchLess_dailyWageThree").find("tr:gt(0)").remove();var e="<tr>";if(f.SystemState==64){if(null!=f.GetWayWagesList&&f.GetWayWagesList.length>0){$.each(f.GetWayWagesList,function(g,h){e+="<td>"+h.User_Name+"</td>";e+="<td>"+h.LossAmount+"</td>";if(h.Reserve1!=""&&h.Reserve1!=null){e+="<td>"+h.Reserve1+"</td>"}else{e+="<td>"+accMul(parseFloat(h.DayWagesRatio),100)+"%</td>"}e+="<td>"+h.SalesVolume+"</td>";e+="<td>"+dailyWageTypeForMoney(h.DetailSource,h.DayWagesAmount)+"</td>";e+="<td>"+h.CreateTime+"</td>";e+="</tr>"})}}$("#searchLess_dailyWageThree").append(e);$.page(c,f.DataCount,"searchLess_dailyWageThree",6,5);hide_bet_loadding()},"json")}function checknum(a){if(/^\d+\.?\d{0,2}$/.test(a.value)){a.value=a.value}else{a.value=a.value.substring(0,a.value.length-1)}}function dailyWageSelectTime(a,d,c){var b=$(a).val();$("#"+d).unbind("click");$("#"+c).unbind("click");if(b==1){$("#"+d).val(getDate(0));$("#"+c).val(getDate(0));$("#"+d).click(function(){WdatePicker({dateFmt:"yyyy-MM-dd",readOnly:true,isShowClear:false,minDate:"%y-%M-{%d-4}",maxDate:"#F{$dp.$D('"+c+"')}"})});$("#"+c).click(function(){var e=$("#"+d).val();WdatePicker({dateFmt:"yyyy-MM-dd",readOnly:true,isShowClear:false,minDate:e,maxDate:"%y-%M-%d"})})}else{$("#"+d).val(getDate(-4));$("#"+c).val(getDate(-4));$("#"+d).click(function(){WdatePicker({dateFmt:"yyyy-MM-dd",readOnly:true,isShowClear:false,minDate:"%y-{%M-3}-{%d-3}",maxDate:"#F{$dp.$D('"+c+"')}"})});$("#"+c).click(function(){var e=$("#"+d).val();WdatePicker({dateFmt:"yyyy-MM-dd",readOnly:true,isShowClear:false,minDate:e,maxDate:"%y-%M-{%d-4}"})})}}function getState_dailywageNew(b){var a="";if(b==0){a="未签约"}else{if(b==1){a="已签约"}}return a}function getMgrType(b){var d={};d.TypeID=b;var a=ctx+"/deedManage/getSystemMgrType";var c={message:json2str(d)};$.ajax({type:"POST",url:a,data:c,async:false,dataType:"json",success:function(e){var f="";$.each(e.SysMgrTypeModel,function(g,h){f+="<option value='"+h.Id+"'>"+h.Name+"</option>"});$("#dayWagesType,#dayWagesType_two,#dayWagesType_three,#dayWagesType_record,#bounsType,#bounsType_two,#bounsType_three,#bounsType_four,#bounsType_five,#bounsType_six,#dayWagesType_report").html(f);$("#dayWagesType_record,#bounsType_six,#dayWagesType_report").prepend("<option value='-1' selected='selected'>全部</option>")}})}function searchDailyWageTableNew(c){var d={};d.UserName=$("#userName").val();d.DayWagesState=$("#dayWagesState").val();d.DwTypeID=$("#dayWagesType").val();d.CurrentPageSize=10;d.CurrentPageIndex=c;var a=ctx+"/deedManage/getContractList";var b={message:json2str(d)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,b,function(g){$("#dailyWageThreeTable").empty();var e="<tr>";if(g.SystemState==64){var f=g.isAllowSign;if(g.ContractList.length>0){$.each(g.ContractList,function(h,j){e+="<td>"+j.UserName+"</td>";e+="<td>"+j.Rebate+"</td>";e+="<td>"+getState_dailywageNew(j.State)+"</td>";e+="<td>";if(f){if(j.State==1){e+='<a class="cp" data-toggle="modal" data-target="#myDailyWageThree_editer" onclick="getMyDownDayWagesNew('+j.UserID+","+d.DwTypeID+',this);">修改契约</a>'}else{e+='<a class="cp" data-toggle="modal" data-target="#myDailyWageThree_editer" onclick="getMyDownDayWagesNew('+j.UserID+","+d.DwTypeID+',this);">签订契约</a>'}}e+="</td></tr>"})}else{e+="<td colspan='4'>无记录</td></tr>"}}else{e+="<td colspan='4'>无记录</td></tr>"}$("#dailyWageThreeTable").html(e);$.page(c,g.DataCount,"",4);hide_bet_loadding()},"json")}function getMyDownDayWagesNew(g,b,h,e){if(!e){var d=$(h).parent().parent().find("td:eq(0)").text();$("#dayWagesType_two").val(b);$("#childrenName,#uname").html(d)}getActiveUserCondition();var f={};f.SubUserId=g;f.DwTypeId=b;var a=ctx+"/deedManage/getMyDownDayWagesNew";var c={message:json2str(f)};$.post(a,c,function(o){$("#rule_tr th:eq(1)").text(o.GrantRemark);$("#btnDivThree").html("");$("#myDailyWageThree").empty();$("#childrenDaily").html(0);var m,j;if(null!=o.MyInfoList&&o.MyInfoList.length>0){$("#myDailyWageThree").html(o.StatisticModeCode==3?(accMul(o.MyInfoList[0].MyProportion,100)+"%"):(accMul(o.MyInfoList[0].MyProportion,10000)))}$("#childrenID").val(g);var l=0;if(null!=o.SubInfoList&&o.SubInfoList.length>0){l=o.SubInfoList[0].MyProportion;$("#childrenDaily").html(o.StatisticModeCode==3?(accMul(o.SubInfoList[0].MyProportion,100)+"%"):(accMul(o.SubInfoList[0].MyProportion,10000)))}var k="<option value=''>请选择新的日结契约</option>";var n="";if(null!=o.RuleList&&o.RuleList.length>0){$.each(o.RuleList,function(p,q){if(o.MaxProportion!=0){if(l<q.DayWagesProportion&&q.DayWagesProportion<=o.MaxProportion){k+="<option value="+q.ID+">"+q.DayWageStandard+"</option>"}if(q.DayWagesProportion<=o.MaxProportion){n+="<tr><td width='35%'>"+q.DayWageStandard+"</td><td width='30%'>"+(q.DaySales==-999999999?0:q.DaySales)+"</td><td width='35%'>"+q.ActiveNumber+"</td></tr>"}}else{if(l<q.DayWagesProportion){k+="<option value="+q.ID+">"+q.DayWageStandard+"</option>"}n+="<tr><td width='35%'>"+q.DayWageStandard+"</td><td width='30%'>"+(q.DaySales==-999999999?0:q.DaySales)+"</td><td width='35%'>"+q.ActiveNumber+"</td></tr>"}})}$("#dailyWageRule").html(k);$("#dailyWageRuleTable").html(n);if(o.isAllowSign){var i="<button type='button' class='btn btn-primary' onclick='modifyDayWagesNew();'>保存</button>";$("#btnDivThree").html(i)}},"json")}function dailyWageNew_callBack(){$("#myDailyWageThree_editer").modal("hide");$("#myDailyWageThree_detail").modal("hide");searchDailyWageTableNew($("#deed_05 .page .active").text()-1)}function modifyDayWagesNew(){var c={};c.UserName=$("#childrenName").html();c.ID=$("#dailyWageRule").val();c.DwTypeId=$("#dayWagesType_two").val();c.User_ID=$("#childrenID").val();c.TypeName=$("#dayWagesType_two option:selected").text();if(c.ID==""){_confirm("warning",1,"","请选择新的日结契约");return}var a=ctx+"/deedManage/modifyDayWagesNew";var b={message:json2str(c)};$.post(a,b,function(e){if(e.Result==1){_confirm("success",0,"","保存成功",dailyWageNew_callBack,dailyWageNew_callBack)}else{_confirm("error",0,"","保存失败")}},"json")}function getMyDailyWageDeedNew(){$("#myDailyWageThree_detail").modal("show");getRuleByDwType()}function getRuleByDwType(){var c={};c.DwTypeId=$("#dayWagesType_three").val();var a=ctx+"/deedManage/getRuleByDwType";var b={message:json2str(c)};$.post(a,b,function(f){$("#detail_tr th:eq(1)").text(f.GrantRemark);$("#myDailyWageThreeTable").empty();var e="";if(f.SystemState==64){if(null!=f.DwRuleList&&f.DwRuleList.length>0){$.each(f.DwRuleList,function(d,j){e+="<tr>";e+='<td width="35%">'+j.DayWageStandard+"</td>";e+='<td width="30%">'+(j.DaySales==-999999999?0:j.DaySales)+"</td>";e+='<td width="35%">'+j.ActiveNumber+"</td>";e+="</tr>";if(d==(f.DwRuleList.length-1)){var g=j.DayWageStandard.indexOf("【");var h=j.DayWageStandard.indexOf("】");$("#myDaily").text(g==-1?j.DayWageStandard:j.DayWageStandard.substring(g+1,h))}})}else{e+="<tr><td colspan='3'>无记录</td></tr>"}}else{e+="<tr><td colspan='3'>无记录</td></tr>"}$("#myDailyWageThreeTable").html(e)},"json")}function searchDailyWageRecordNew(b,d){var e={};e.UserName=$("#userName").val();e.ProvideTyp=$("#dayWagesType_record").val();e.IsSelf=b;e.BeginTime=$("#starttime").val()+" 00:00:00";e.EndTime=$("#endtime").val()+" 23:59:59";e.CurrentPageSize=10;e.CurrentPageIndex=d;e.IsHistory=false;if($("#selectTime").val()==0){e.IsHistory=true}var a=ctx+"/deedManage/searchDailyWageRecordNew";var c={message:json2str(e)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,c,function(g){if(b==0){$("#selfTable_dailyWageThree tr:gt(0)").remove()}else{$("#childrenTable_dailyWageThree tr:gt(0)").remove()}if(g.SystemState==64){if(g.DaiyWagesList!=null&&g.DaiyWagesList.length>0){datacount=g.DaiyWagesList.length;var f="";$.each(g.DaiyWagesList,function(h,k){f+="<tr>";f+="<td>"+k.User_Name+"</td>";if(k.Reserve2!=""&&k.Reserve2!=null){f+="<td>"+k.Reserve2+"</td>"}else{f+="<td>"+getDetailSource(k.DetailSource)+"</td>"}f+="<td>"+k.SalesVolume+"</td>";f+="<td>"+k.LossAmount+"</td>";f+="<td>"+k.ActivePersonNum+"</td>";if(k.Reserve1!=""&&k.Reserve1!=null){f+="<td>"+k.Reserve1+"</td>"}else{f+="<td>"+accMul(parseFloat(k.DayWagesRatio),100)+"%</td>"}var j=k.DayWagesAmount;if(k.DetailSource==266||k.DetailSource==264){j=-j}f+="<td>"+j+"</td>";f+="<td>"+k.CreateTime+"</td>";f+="</tr>"});if(b==0){$("#selfTable_dailyWageThree").append(f)}else{$("#childrenTable_dailyWageThree").append(f)}}if(b==0){$.page(d,g.DataCount,"selfTable_dailyWageThree",8)}else{$.page(d,g.DataCount,"childrenTable_dailyWageThree",8)}}hide_bet_loadding()},"json")}function dailywagesGetRecordsAmt(){var c={};c.UserName=$("#userName").val();c.ProvideType=$("#dayWagesType_record").val();c.BeginTime=$("#starttime").val()+" 00:00:00";c.EndTime=$("#endtime").val()+" 23:59:59";c.IsHistory=false;if($("#selectTime").val()==0){c.IsHistory=true}var a=ctx+"/deedManage/dailywages/get_records/amt";var b={message:json2str(c)};$.post(a,b,function(e){if(e.Code==200){$("#_sumInfo").html("日结金额合计："+e.Data.DailyWagesAmt+" 元")}},"json")}function getDetailSource(a){var b="";if(a==301){b="消费日结"}else{if(a==302){b="亏损日结"}else{if(a==263){b="来自上级的日结"}else{if(a==264){b="发给下级的日结"}else{if(a==265){b="人工添加日结"}else{if(a==266){b="人工扣除日结"}else{b="全部"}}}}}}return b}function initDailyRecord(){searchDailyWageRecordNew(0,0);searchDailyWageRecordNew(1,0);dailywagesGetRecordsAmt()}function getStateNew(b){var a="";if(b==0){a="待确认"}else{if(b==1){a="已签约"}else{if(b==2){a="未签约"}}}return a}function searchBonusTableNew(c){var d={};d.UserName=$("#userName").val();d.TypeParameterId=$("#bounsType").val();d.ContractState=$("#status").val();d.CurrentPageSize=10;d.CurrentPageIndex=c;var a=ctx+"/deedManage/getBonusContent";var b={message:json2str(d)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,b,function(g){$("#bonusTable").empty();var e="<tr>";if(g.SystemState==64){var f=g.IsSubContract;$("#onekeybounsId").val(d.TypeParameterId);$("#bounsTypeName,#bounsTypeName_").text($("#bounsType option:selected").text());myState_bonusDeed=g.State;if(g.State==-1){$("#mybonusDeed").hide()}else{$("#mybonusDeed").show();if(g.State==0&&f==1){$("#bounsType_two").val($("#bounsType").val());_confirm("warning",1,"","有契约哦！",getMybonusDeedNew);$(".modal-content").find(".btn-ok").text("现在去签")}}if(g.LockState==1){$("#myOneKeySettlement").show()}else{$("#myOneKeySettlement").hide()}$("#updateTime").html(g.UpdateDateTime);if(g.ContractManagerModels.length>0){$.each(g.ContractManagerModels,function(h,j){e+="<td>"+j.UserName+"</td>";e+="<td>"+j.Rebate+"</td>";e+="<td>"+getStateNew(j.State)+"</td>";e+="<td>";if(f==1){if(j.State!=2){e+='<a class="cp" data-toggle="modal" data-target="#myBonus_editer" onclick="getContractDetailsNew('+j.UserID+","+d.TypeParameterId+',this);">修改契约</a>'}else{e+='<a class="cp" data-toggle="modal" data-target="#myBonus_editer" onclick="getContractDetailsNew('+j.UserID+","+d.TypeParameterId+',this);">签订契约</a>'}}if(g.LockState==1&&j.State!=2){e+='<a class="cp" data-toggle="modal" data-target="#myBonus_05" onclick="getDividendSettlementNew('+j.UserID+","+d.TypeParameterId+',this);">分红结算</a>'}e+="</td></tr>"})}}$("#bonusTable").html(e);$.page(c,g.DataCount,"bonusTable",4);hide_bet_loadding()},"json")}function getMybonusDeedNew(){$("#myBonus_detail").modal("show");var c={};c.UserID=myUserID;c.TypeParameterId=$("#bounsType_two").val();var a=ctx+"/deedManage/getMyBonusDeedNew";var b={message:json2str(c)};$.post(a,b,function(f){$("#agreeBonus_btn").show();$("#btype").text($("#bounsType_two option:selected").text());$("#myBonusDeedTable").empty();$("#myBonusDeedTable_update").empty();var e="<tr>";var g="<tr>";if(f.SystemState==64){if(f.MyBonusList.length>0){$.each(f.MyBonusList,function(d,h){e+="<td>"+h.BetMoneyMin+"</td>";e+="<td>"+h.LossMoneyMin+"</td>";e+="<td>"+h.ActivePersonNum+"</td>";e+="<td>"+accMul(parseFloat(h.DividendRatio),100)+"%</td>";e+="</tr>"})}else{e+="<td colspan='4'>无记录</td></tr>"}if(f.ModifyList.length>0){$("#edit_title").show();$("#updateTime").text(f.ModifyTime);$.each(f.ModifyList,function(d,h){g+="<td>"+h.BetMoneyMin+"</td>";g+="<td>"+h.LossMoneyMin+"</td>";g+="<td>"+h.ActivePersonNum+"</td>";g+="<td>"+accMul(parseFloat(h.DividendRatio),100)+"%</td>";g+="</tr>"});$("#updateTip").show();$("#agreeBtnDiv").show();$("#myBonus_afterTable").show();$(".myBonus").show()}else{$("#edit_title").hide();$("#updateTip").hide();$("#agreeBtnDiv").hide();g+="<td colspan='4'>无记录</td></tr>";$(".myBonus").hide();$("#myBonus_afterTable").hide()}}else{e+="<td colspan='4'>无记录</td></tr>";g+="<td colspan='4'>无记录</td></tr>"}$("#myBonusDeedTable").html(e);$("#myBonusDeedTable_update").html(g)},"json")}function _callBackNew(){$("#myBonus_editer").modal("hide");$("#myBonus_detail").modal("hide");$("#myBonus_05").modal("hide");searchBonusTableNew($("#deed_03 .page .active").text()-1)}function agreeBonusDeedNew(c){var f={};f.UserName=personObj.UserName;f.IsAgree=c;f.TypeParameterId=$("#bounsType_two").val();var b=ctx+"/deedManage/agreeBonusContract";var e={message:json2str(f)};var a="";var d="";if(c==1){a="您的契约已经变更，下次分红将按照新的契约执行";d="变更失败"}else{a="您已拒绝了上级的契约修改";d="拒绝失败"}$("#agreeBonus_btn").hide();$.post(b,e,function(g){if(g.Result){_confirm("success",0,"",a,_callBackNew,_callBackNew)}else{_confirm("error",0,"",d,_callBackNew,_callBackNew)}},"json")}function onekeySettlementTip(){var c={};c.Number=1;c.TypeParameterId=$("#onekeybounsId").val();var a=ctx+"/deedManage/getContractPeriod";var b={message:json2str(c)};$.post(a,b,function(f){if(f.GetCurrentPeriodList!=null&&f.GetCurrentPeriodList.length>0){var e=f.GetCurrentPeriodList[0];$("#dividendCycle_").text(e.BeginTime+"—"+e.EndTime);$("#beginT").val(e.BeginTime);$("#endT").val(e.EndTime)}},"json");$("#myBonus_06").modal("show")}function oneKeySettlementNew(){var c={};c.Sign=1;c.BeginTime=$("#beginT").val();c.EndTime=$("#endT").val();c.TypeParameterId=$("#onekeybounsId").val();c.TypeName=$("#bounsTypeName").text();var a=ctx+"/deedManage/oneKeySettlementNew";var b={message:json2str(c)};$.post(a,b,function(e){if(e.StateBool){$("#myBonus_06").modal("hide");_confirm("success",0,"","结算成功",function(){searchBonusTableNew(0)},function(){searchBonusTableNew(0)})}else{_confirm("error",0,"","结算失败",function(){searchBonusTableNew(0)},function(){searchBonusTableNew(0)})}},"json")}function getContractDetailsNew(h,b,g,e){if(!e){var d=$(g).parent().parent().find("td:eq(0)").text();$("#bounsType_four").val(b);$("#childrenName").text(d)}var f={};f.UserID=h;f.TypeParameterId=b;var a=ctx+"/deedManage/getContractDetailsNew";var c={message:json2str(f)};$.post(a,c,function(k){$("#myBonusTable").empty();$("#btnDiv").html("");var j="";if(k.UserBonusList.length>0){$.each(k.UserBonusList,function(l,m){j+="<tr>";j+="<td><input type='text' maxlength='9' value="+m.BetMoneyMin+" class='form-control' onchange='checkInt(this.value);' onkeyup=\"this.value=this.value.replace(/\\D/g,'')\" onafterpaste=\"this.value=this.value.replace(/\\D/g,'')\" ></td>";j+="<td><input type='text' maxlength='9' value="+m.LossMoneyMin+" class='form-control' onchange='checkInt(this.value);' onkeyup=\"this.value=this.value.replace(/\\D/g,'')\" onafterpaste=\"this.value=this.value.replace(/\\D/g,'')\" ></td>";j+="<td><input type='text' maxlength='4' value="+m.ActivePersonNum+" class='form-control' onchange='checkInt(this.value);' onkeyup=\"this.value=this.value.replace(/\\D/g,'')\" onafterpaste=\"this.value=this.value.replace(/\\D/g,'')\" ></td>";j+="<td><input type='text' maxlength='5' value="+accMul(parseFloat(m.DividendRatio),100)+" class='form-control' onkeyup='checknum(this)'></td>";j+="<td>";if(l>0){j+="<a onclick='delLine(this);' >删除</a>&nbsp;&nbsp;"}if(l==k.UserBonusList.length-1){j+="<a onclick='addLine(this);'>添加行</a>"}j+="</td></tr>"})}else{j+="<tr>";j+="<td><input type='text' value='0' maxlength='9' class='form-control' onchange='checkInt(this.value);' onkeyup=\"this.value=this.value.replace(/\\D/g,'')\" onafterpaste=\"this.value=this.value.replace(/\\D/g,'')\" ></td>";j+="<td><input type='text' value='0' maxlength='9' class='form-control' onchange='checkInt(this.value);' onkeyup=\"this.value=this.value.replace(/\\D/g,'')\" onafterpaste=\"this.value=this.value.replace(/\\D/g,'')\" ></td>";j+="<td><input type='text' value='0' maxlength='4' class='form-control' onchange='checkInt(this.value);' onkeyup=\"this.value=this.value.replace(/\\D/g,'')\" onafterpaste=\"this.value=this.value.replace(/\\D/g,'')\" ></td>";j+="<td><input type='text' maxlength='5' class='form-control' onkeyup='checknum(this)'></td>";j+="<td><a onclick='addLine(this);'>添加行</a></td>";j+="</tr>"}$("#_lines").html(j);$("#childrenID").val(h);if(k.IsSubContract==1){var i="<button type='button' class='btn btn-primary' onclick='addBonusNew();'>保存</button>";$("#btnDiv").html(i)}},"json")}function addBonusNew(){var e={};e.UserName=personObj.UserName;e.LoginUserName=$("#childrenName").text();e.TypeName=$("#bounsType_four option:selected").text();e.UserID=personObj.MyUserID;e.TypeParameterId=$("#bounsType_four").val();e.ContractContentModels=[];var j=$("#_lines").children("tr");for(var f=0;f<j.length;f++){var b={};b.BetMoneyMin=$(j[f]).children("td:eq(0)").find("input").val();b.LossMoneyMin=$(j[f]).children("td:eq(1)").find("input").val();b.ActivePersonNum=$(j[f]).children("td:eq(2)").find("input").val();if(parseInt(b.BetMoneyMin)>999999999){_confirm("warning",0,"","消费额范围为0-999999999");return false}if(parseInt(b.LossMoneyMin)>999999999){_confirm("warning",0,"","亏损额范围为0-999999999");return false}if(parseInt(b.ActivePersonNum)>1000){_confirm("warning",0,"","活跃人数范围为0-1000");return false}if(f==j.length-1){b.BetMoneyMax=999999999;b.LossMoneyMax=999999999}else{b.BetMoneyMax=$(j[f+1]).children("td:eq(0)").find("input").val();b.LossMoneyMax=$(j[f+1]).children("td:eq(1)").find("input").val();var h=$(j[f+1]).children("td:eq(2)").find("input").val();if(parseInt(b.BetMoneyMin)>parseInt(b.BetMoneyMax)||parseInt(b.LossMoneyMin)>parseInt(b.LossMoneyMax)||parseInt(b.ActivePersonNum)>parseInt(h)){_confirm("warning",0,"","存在错误信息");return}if(parseInt(b.BetMoneyMax)>999999999){_confirm("warning",0,"","消费额范围为0-999999999");return false}if(parseInt(b.LossMoneyMax)>999999999){_confirm("warning",0,"","亏损额范围为0-999999999");return false}if(parseInt(b._actNum)>1000){_confirm("warning",0,"","活跃人数范围为0-1000");return false}}b.ActivePersonNum=$(j[f]).children("td:eq(2)").find("input").val();var g=$(j[f]).children("td:eq(3)").find("input").val();var c=/^[0-9]+(.[0-9]{0,2})?$/;if(""==g||null==g){_confirm("warning",0,"","分红比例不能为空");return}else{if(!(c.test(g))){_confirm("warning",0,"","输入有误,比例范围为0.01%-100%");return}else{if(parseFloat(g)>100||parseFloat(g)<0.01){_confirm("warning",0,"","输入有误,比例范围为0.01%-100%");return}}}b.DividendRatio=accDiv(parseFloat(g),100);e.ContractContentModels.push(b)}var a=ctx+"/deedManage/addBonusContractNew";var d={message:json2str(e)};$.post(a,d,function(i){if(i.Result>0){_confirm("success",0,"","保存成功",_callBackNew,_callBackNew)}else{if(i.Result==-1){_confirm("error",0,"","用户不存在")}else{if(i.Result==-2){_confirm("error",0,"","不能添加会员")}else{if(i.Result==-3){_confirm("error",0,"","该代理已添加分红契约")}else{if(i.Result==-4){_confirm("error",0,"","级别超过限制")}else{if(i.Result==-5){_confirm("error",0,"","您尚未签约，不能与下级签约！")}else{_confirm("error",0,"","保存失败")}}}}}}},"json")}function getDividendSettlementNew(b,c,g,h){var e=$(g).parent().parent().find("td:eq(0)").text();$("#_uname").val(e);$("#_name1").html(e);$("#_name2").html(e);var f={};f.UserID=b;f.TypeParameterId=c;$("#_id").val(b);var a=ctx+"/deedManage/getDividendSettlementNew";var d={message:json2str(f)};$.post(a,d,function(l){$("#_bonus1").empty();$("#_bonus2").empty();var j="<tr>";var k="<tr>";if(l.SystemState==64){$("#dividendCycle").html(l.DividendCycle);if(l.GetDividendContractList.length>0){$.each(l.GetDividendContractList,function(m,n){j+="<td>"+n.Expenditure+"</td>";j+="<td>"+n.LossAmount+"</td>";j+="<td>"+n.ActivePeopleNum+"</td>";j+="<td>"+accMul(parseFloat(n.DividendRatio),100)+"%</td>";j+="</tr>"})}else{j+="<td colspan='4'>无记录</td></tr>"}if(l.GetBonusPreviewModels!=""){var i=l.GetBonusPreviewModels;k+="<td>"+i.TotalBets+"</td>";k+="<td>"+i.GrossProfit+"</td>";k+="<td>"+i.ActivePeopleNum+"</td>";k+="<td>"+accMul(parseFloat(i.DividendRatio),100)+"%</td>";k+="</tr>";k+='<tr><td colspan="4">应得分红：<span style="color: #FF0000;" id="deservedDividend">'+Math.abs(i.DeservedDividend)+"</span></td></tr>"}else{k+="<td colspan='4'>无记录</td></tr>"}}else{j+="<td colspan='4'>无记录</td></tr>";k+="<td colspan='4'>无记录</td></tr>"}$("#_bonus1").html(j);$("#_bonus2").html(k)},"json")}function bonusSettlementNew(){var c={};c.DownUserId=$("#_id").val();c.DownUserName=$("#_uname").val();c.TypeParameterId=$("#onekeybounsId").val();c.TypeName=$("#bounsTypeName_").text();var a=ctx+"/deedManage/bonusSettlementNew";var b={message:json2str(c)};$.post(a,b,function(e){if(e.Result>0){_confirm("success",0,"","结算成功",_callBackNew,_callBackNew)}else{if(e.Result==-1){_confirm("error",0,"","该周期已分红",_callBackNew,_callBackNew)}else{if(e.Result==-2){_confirm("error",0,"","上级是自己，不能自己分红",_callBackNew,_callBackNew)}else{if(e.Result==-3){_confirm("error",0,"","余额不足 不能分红",_callBackNew,_callBackNew)}else{if(e.Result==-4){_confirm("error",0,"","该用户已结算",_callBackNew,_callBackNew)}else{_confirm("error",0,"","结算失败",_callBackNew,_callBackNew)}}}}}},"json")}function searchBonusRecordNew(b,d){$("#childrenTable tr:gt(0)").remove();var e={};e.UserID=personObj.MyUserID;e.UserName=$("#userName").val();e.TypeId=$("#bounsType_six").val();e.IsSelf=b;e.BeginTime=$("#starttime").val()+" 00:00:00";e.EndTime=$("#endtime").val()+" 23:59:59";e.IsHistory=false;if($("#selectTime").val()==0){e.IsHistory=true}e.CurrentPageSize=10;e.CurrentPageIndex=d;var a=ctx+"/deedManage/getDividentsList_New";var c={message:json2str(e)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,c,function(g){if(b==0){$("#selfTable tr:gt(0)").remove()}else{$("#childrenTable tr:gt(0)").remove()}if(g.SystemState==64){if(g.DividentsDetailAllList!=null&&g.DividentsDetailAllList.length>0){var f="";$.each(g.DividentsDetailAllList,function(h,j){f+="<tr>";f+="<td>"+j.UserName+"</td>";f+="<td>"+j.TypeName+"</td>";f+="<td>"+j.TotalBatMoney+"</td>";f+="<td>"+j.TotalProfitLossMoney+"</td>";f+="<td>"+j.ActivePersonNum+"</td>";f+="<td>"+accMul(parseFloat(j.DividendRatio),100)+"%</td>";f+="<td>"+j.DividentMoney+"</td>";f+="<td>"+j.CreateTime+"</td>";f+="</tr>"});if(b==0){$("#selfTable").append(f);$.page(d,g.DataCount,"selfTable",8)}else{$("#childrenTable").append(f);$.page(d,g.DataCount,"childrenTable",8)}}else{if(b==0){$.page(d,0,"selfTable",8)}else{$.page(d,0,"childrenTable",8)}}}hide_bet_loadding()},"json")}function dividentsGetRecordsAmt(){var c={};c.UserID=personObj.MyUserID;c.UserName=$("#userName").val();c.TypeId=$("#bounsType_six").val();c.BeginTime=$("#starttime").val()+" 00:00:00";c.EndTime=$("#endtime").val()+" 23:59:59";c.IsHistory=false;if($("#selectTime").val()==0){c.IsHistory=true}var a=ctx+"/deedManage/dividents/get_records/amt";var b={message:json2str(c)};$.post(a,b,function(e){if(e.Code==200){$("#_sumInfo").html("分红金额合计："+e.Data.DividentAmt+"元")}},"json")}function initBonusRecord(){searchBonusRecordNew(0,0);searchBonusRecordNew(1,0);dividentsGetRecordsAmt()}function getDataParameterInfo(){var c={};c.isShow=1;var a=ctx+"/deedManage/getDataParameterInfo";var b={message:json2str(c)};$.ajax({type:"POST",url:a,data:b,async:false,dataType:"json",success:function(d){var e="";$.each(d.Lists,function(f,g){e+="<option value='"+g.Id+"'>"+g.WebName+"</option>"});$("#lotteryType").html(e)}})}function searchInstitutionalReportList(e,h,f,g){var b="<a href='#' id='cur_userAgent' class='cp'>"+personObj.UserName+"</a>";$("#_currentUser").html(b);var d={};if((typeof(f)=="undefined")||f==""){d.UserID=personObj.MyUserID;$("#ch_userID,#ch_userName").val("")}else{d.UserID=f;$("#ch_userID").val(f);var i="";if(g){i=$(g).text();$("#ch_userName").val(i)}else{i=$("#ch_userName").val()}getParentsAgentTreeInfo(i,f)}d.LotteryId=$("#lotteryType").val();d.Datetime=$("#dateTime").val();d.IsSelf=e;d.CurrentPageSize=10;d.CurrentPageIndex=h;var a=ctx+"/deedManage/getInstitutionalReportList";var c={message:json2str(d)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,c,function(l){if(l.SystemState==64){var j="";var k="style='color:#FF0000;'";if(e==0){$("#self_Statistics").empty()}else{$("#lower_Statistics").empty();k="class='cb'"}if(l.SysMgrList!=null&&l.SysMgrList.length>0){$.each(l.SysMgrList,function(m,n){j+="<tr>";if(n.ChildNum>0){j+="<td width='10%'><a href='javascript:void(0)' "+k+"  onclick='searchInstitutionalReportList(1,0,"+n.UserID+",this)'>"+n.UserName+"</a></td>"}else{j+='<td width="10%">'+n.UserName+"</td>"}j+='<td width="10%">'+n.ActiveNumber+"</td>";j+='<td width="15%">'+n.BetMoney+"</td>";j+='<td width="10%">'+n.RebateMoney+"</td>";j+='<td width="15%">'+n.WinnMoney+"</td>";j+='<td width="10%">'+n.OtherMoney+"</td>";if(n.LossMoney>=0){j+="<td width='15%' data-toggle='tooltip' title="+n.LossMoney+" style='color:#FF0000;'>"+getScreen(n.LossMoney+"",6,8)+"</td>"}else{j+="<td width='15%' data-toggle='tooltip' title="+n.LossMoney+" style='color:#00CC33;'>"+getScreen(n.LossMoney+"",6,8)+"</td>"}if(n.NoLossAccountMoney>=0){j+="<td width='15%' data-toggle='tooltip' title="+n.NoLossAccountMoney+" style='color:#FF0000;'>"+getScreen(n.NoLossAccountMoney+"",6,8)+"</td>"}else{j+="<td width='15%' data-toggle='tooltip' title="+n.NoLossAccountMoney+" style='color:#00CC33;'>"+getScreen(n.NoLossAccountMoney+"",6,8)+"</td>"}j+="</tr>"});if(e==0){$("#self_Statistics").append(j)}else{$("#lower_Statistics").append(j);$.page(h,l.DataCount,"lower_Statistics",8,10)}}else{j="<tr><td align ='center' colspan='8'>无记录</td></tr>;";if(e==0){$("#self_Statistics").append(j)}else{$("#lower_Statistics").append(j)}}hide_bet_loadding()}},"json");if(d.IsSelf==1){searchInstitutionalReportList(0,0,f);searchInstitutionalReportTotal(f)}}function searchInstitutionalReportTotal(b){var d={};d.UserID=!!b?b:personObj.MyUserID;d.LotteryId=$("#lotteryType").val();d.Datetime=$("#dateTime").val();var a=ctx+"/deedManage/getInstitutionalReportTotal";var c={message:json2str(d)};bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,c,function(f){if(f.SystemState==64){$("#team_Statistics tr:gt(0)").remove();var e="";if(f.SysMgrList!=null&&f.SysMgrList.length>0){$.each(f.SysMgrList,function(g,h){e+="<tr>";e+='<td width="10%">合计</td>';e+='<td width="10%">'+h.ActiveNumber+"</td>";e+='<td width="15%">'+h.BetMoney+"</td>";e+='<td width="10%">'+h.RebateMoney+"</td>";e+='<td width="15%">'+h.WinnMoney+"</td>";e+='<td width="10%">'+h.OtherMoney+"</td>";if(h.LossMoney>=0){e+="<td width='15%' data-toggle='tooltip' title="+h.LossMoney+" style='color:#FF0000;'>"+getScreen(h.LossMoney+"",6,8)+"</td>"}else{e+="<td width='15%' data-toggle='tooltip' title="+h.LossMoney+" style='color:#00CC33;'>"+getScreen(h.LossMoney+"",6,8)+"</td>"}if(h.NoLossAccountMoney>=0){e+="<td width='15%' data-toggle='tooltip' title="+h.NoLossAccountMoney+" style='color:#FF0000;'>"+getScreen(h.NoLossAccountMoney+"",6,8)+"</td>"}else{e+="<td width='15%' data-toggle='tooltip' title="+h.NoLossAccountMoney+" style='color:#00CC33;'>"+getScreen(h.NoLossAccountMoney+"",6,8)+"</td>"}e+="</tr>"});$("#team_Statistics").append(e)}else{e="<tr><td align ='center' colspan='8'>无记录</td></tr>;";$("#team_Statistics").append(e)}hide_bet_loadding()}},"json")}function searchInstitutionalReport(){searchInstitutionalReportList(1,0)}function getParentsAgentTreeInfo(b,d){var c={};c.UserName=b;var a=ctx+"/agentCenter/getParentsAgentTreeInfo";$.post(a,{message:json2str(c)},function(f){if(null!=f.GetUserParentInfo&&f.GetUserParentInfo.length>0){var e="";var g=f.GetUserParentInfo.reverse();$.each(g,function(h,j){e+="<a href='#' class='cp' uname="+j.UserName+" onclick='searchInstitutionalReportList(1,0,"+j.User_Id+",this);'>"+j.UserName+"</a>>"});if(d!=""){e+="<a href='#' class='cp' uname="+b+" onclick='searchInstitutionalReportList(1,0,"+d+",this);'>"+b+"</a>"}$("#_currentUser").html(e)}},"json")}function getActiveUserCondition(){var b={};b.DayWagesTypeid=$("#dayWagesType_two").val();var a=ctx+"/deedManage/getDayWageActiveUserCondition";$.post(a,{message:json2str(b)},function(c){if(c.Code==200){if(c.Consumption!=0&&c.Recharge!=0){$("#activeCondition").text("当日充值量大于"+parseFloat(c.Recharge)+"元并且当日投注量大于"+parseFloat(c.Consumption)+"元为活跃用户。")}else{if(c.Consumption==0){$("#activeCondition").text("当日充值量大于"+parseFloat(c.Recharge)+"元为活跃用户。")}else{if(c.Recharge==0){$("#activeCondition").text("当日投注量大于"+parseFloat(c.Consumption)+"元为活跃用户。")}else{$("#activeCondition").text("")}}}}},"json")}function searchDailyWageReport(){var a=$("#username").val();GetTotalChildReport(0,"",a)}function GetTotalChildReport(d,c,f,g){$("#_currentUser").html("");if(c){$("#ch_userID").val(c);$("#username").val("")}else{$("#ch_userID").val("");$("#ch_userName").val("")}var e={};e.UserName=(typeof f=="undefined")?$("#username").val():f;var b=$(".page_size option:selected").val()*1;e.UserID=!!c?c:$("#team_userID").val();e.BeginTime=$("#starttime").val()+" 00:00:00";e.EndTime=$("#starttime").val()+" 23:59:59";e.CurrentPageIndex=d;e.CurrentPageSize=b;e.IsHistory=false;if($("#selectTime").val()==0){e.IsHistory=true}if(e.UserName&&c==""){getParentsAgentTreeInfo_(e.UserName,"")}if(c){var a="";if(g){a=$(g).attr("uname");$("#ch_userName").val(a)}else{a=$("#ch_userName").val()}getParentsAgentTreeInfo_(a,c)}bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(ctx+"/deedManage/dailyWages_GetRepotrsChild",{message:json2str(e)},function(i){$("#lower_Statistics").empty();if(i.Code==200){var h="";if(i.ReportComm!=null){$.each(i.ReportComm,function(j,k){h+="<tr>";if(k.ChildNum>0){h+="<td width='10%' title="+k.UserName+"><a uname="+k.UserName+" class='cb' onclick=GetTotalChildReport(0,"+k.UserId+",'"+k.UserName+"',this)>"+k.UserName+"</a></td>"}else{h+="<td width='10%'>"+k.UserName+"</td>"}h+="<td width='18%' data-toggle='tooltip' title="+k.LevelDailywage+">"+k.LevelDailywage+"</td>";h+="<td width='18%' data-toggle='tooltip' title="+k.OtherDailywage+">"+k.OtherDailywage+"</td>";h+="<td width='18%' data-toggle='tooltip' title="+k.DailywageAmount+">"+k.DailywageAmount+"</td>";h+="<td width='18%' data-toggle='tooltip' title="+k.ThirdDailywage+">"+k.ThirdDailywage+"</td>";if(k.TotalDailywage>=0){h+="<td width='18%' title="+k.TotalDailywage+" style='color:#00CC33'>"+k.TotalDailywage+"</td>"}else{h+="<td width='18%' title="+k.TotalDailywage+" style='color:#FF0000'>"+k.TotalDailywage+"</td>"}h+="</tr>"});$("#lower_Statistics").append(h)}}$.page(d,i.DataCount,"lower_Statistics",6,b);hide_bet_loadding()},"json");Gettotalreport("1",$("#self_Statistics"),f,e.UserID);Gettotalreport("0",$("#team_Statistics"),f,e.UserID)}function Gettotalreport(a,c,e,b){var d={};d.UserName=(""==e||typeof e=="undefined")?$("#username").val():e;d.UserID=(""==b||typeof b=="undefined")?"-1":b;d.BeginTime=$("#starttime").val()+" 00:00:00";d.EndTime=$("#starttime").val()+" 23:59:59";d.ISself=a;d.IsHistory=false;if($("#selectTime").val()==0){d.IsHistory=true}$.post(ctx+"/deedManage/dailyWages_GetRepotrs",{message:json2str(d)},function(g){if(g.Code==200){c.empty();var f="";f+="<tr>";if(a=="1"){if(g.UserName==""){f+="<td width='10%'>--</td>"}else{f+="<td width='10%'>"+g.UserName+"</td>"}}else{f+="<td width='10%'>合计</td>"}f+="<td width='18%' data-toggle='tooltip' title="+g.LevelDailywage+">"+g.LevelDailywage+"</td>";f+="<td width='18%' data-toggle='tooltip' title="+g.OtherDailywage+">"+g.OtherDailywage+"</td>";f+="<td width='18%' data-toggle='tooltip' title="+g.DailywageAmount+">"+g.DailywageAmount+"</td>";f+="<td width='18%' data-toggle='tooltip' title="+g.ThirdDailywage+">"+g.ThirdDailywage+"</td>";if(g.TotalDailywage>=0){f+="<td width='18%' title="+g.TotalDailywage+" style='color:#00CC33'>"+g.TotalDailywage+"</td>"}else{f+="<td width='18%' title="+g.TotalDailywage+" style='color:#FF0000'>"+g.TotalDailywage+"</td>"}f+="</tr>";c.append(f)}},"json")}function dailyWageReportTime(a,d){var b=$(a).val();$("#"+d).unbind("click");if(b==1){$("#"+d).val(getDate(0));var c=getDate(0);$("#"+d).click(function(){WdatePicker({dateFmt:"yyyy-MM-dd",readOnly:true,isShowClear:false,minDate:"%y-%M-{%d-4}",maxDate:c})})}else{$("#"+d).val(getDate(-4));var c=getDate(-4);$("#"+d).click(function(){WdatePicker({dateFmt:"yyyy-MM-dd",readOnly:true,isShowClear:false,minDate:"%y-{%M-3}-{%d+1}",maxDate:c})})}}function initPersonData(){$("#team_userID").val(personObj.MyUserID);$("#team_childCount").val(personObj.ChildCount);$("#team_teamMemberCount").val(personObj.TeamMemberCount)}function getParentsAgentTreeInfo_(b,d){var c={};c.UserName=b;var a=ctx+"/agentCenter/getParentsAgentTreeInfo";$.post(a,{message:json2str(c)},function(f){if(null!=f.GetUserParentInfo&&f.GetUserParentInfo.length>0){var e="";var g=f.GetUserParentInfo.reverse();$.each(g,function(h,j){e+='<a href="#" class="cp" uname='+j.UserName+' onclick="GetTotalChildReport(0,'+j.User_Id+",'"+j.UserName+"',this);\">"+j.UserName+"</a>>"});e+="<span style='color: #555;' uname="+b+">"+b+"</span>";$("#_currentUser").html(e)}},"json")};