OpenAccount={HRebate:"",QRebate:"",QARebate:"",CRebate:"",XRebate:"",MaxRebate:"",MinRebate:"",MyRebate:"",userFlag:false,_dataCount:0,init:function(){this.HRebate=$("#HRebate").val()*1;this.QRebate=$("#QRebate").val()*1;this.QARebate=$("#QARebate").val()*1;this.CRebate=$("#CRebate").val()*1;this.XRebate=$("#XRebate").val()*1;this.MaxRebate=$("#MaxRebate").val()*1;this.MinRebate=$("#MinRebate").val()*1;this.MyRebate=$("#MyRebate").val()*1;$("#username_").blur(function(){var a=OpenAccount;var c=$(this).val();$(this).css({border:"solid 1px #ed344a"});if(isNull(c)){$("#username_").attr("data-original-title","开户名在6-16个字符之间，只能由数字、字母中的任意一种或多种组成").focus();$("#tr_bderName").tooltip();a.userFlag=false;return false}if(isUsername(c)){$("#username_").removeAttr("style");$("#username_").removeAttr("data-original-title")}else{$("#username_").attr("data-original-title","用户名在6-16个字符之间，只能由数字、字母中的任意一种或多种组成").focus();$("#tr_bderName").tooltip();a.userFlag=false;return false}var b={};b.SaleID=$("#merchantCode").val();b.Username=c;OpenAccount.checkUsername(b);$("#username_").tooltip()});$("a[name='lowerType']").click(function(a){$("a[name='lowerType'].btn-primary").addClass("gborder_btn").removeClass("btn-primary");$(this).removeClass("gborder_btn").addClass("btn-primary");$("#lowerType").val($(this).attr("value"));OpenAccount.rebateSet($(this).attr("value"))});$("input[name='lowerType']:eq(0)").click();$("#saveRegister").click(function(){var a=$("#username_").val().length;if((a<6)||(a>16)){_confirm("warning",0,"","由6-16个数字或字母组成");return}OpenAccount.saveRegister()});$("#links_generate").click(function(){OpenAccount.links_generate()})},_copy_tips:function(){var a=$("<div class='copy-tips' style='width:80px; float:right; padding-top:8px;'><div class='copy-tips-wrap'>☺ 复制成功</div></div>");$("#alert").find(".copy-tips").remove().end().append(a);$(".copy-tips").fadeOut(3000)},rebateSet:function(b){var c;b==1?(c=handRebate):(c=handQRebate);$("#rebateSet").find("option").remove();c=this.getMin((this.MyRebate),c);for(var a=c;a>=this.MinRebate;a-=this.XRebate){$("#rebateSet").append("<option value='"+a+"'>"+a+"</opiton>")}},referralLinks:function(b){var c;b==1?(c=qARebate):(c=qRebate);$("#rebateSet_link").find("option").remove();c=this.getMin((this.MyRebate),c);for(var a=c;a>=this.MinRebate;a-=this.XRebate){$("#rebateSet_link").append("<option value='"+a+"'>"+a+"</opiton>")}},getMin:function(d,c){return d>c?c:d},checkUsername:function(c){var b=OpenAccount;var a=ctx+"/agentCenter/CheckUserName";$.ajax({type:"post",url:a,data:{message:json2str(c)},dataType:"json",async:false,success:function(e){if(e.Result==1){$("#username_").attr("data-original-title","该用户名已存在").focus();$("#username_").css({border:"solid 1px #ed344a"});b.userFlag=false}else{$("#username_").removeAttr("data-original-title");b.userFlag=true}$("#username_").tooltip()}})},generate:function(){var a=ctx+"/agentCenter/SetUserPromotionRebate";var b={};b.Rebate=$("#referralLinks").val();$.post(a,{message:json2str(b)},function(c){if(c.IsComplete){}},"json")},_open_account_level:function(a){$("#lowerType").val($(a).attr("value"))},saveRegister:function(){bet_Loadding("正在处理中，请稍后……","#myTab_Content0 .tab-content");var b=$("input[name='lowerType']:checked").val();var c={};c.UserName=$("#username_").val();if(null==c.UserName||""==c.UserName){_confirm("warning",0,"","账号不能为空");$("#username_").focus();hide_bet_loadding();return}if(!this.userFlag){hide_bet_loadding();return}c.Password="a123456";c.Rebate=$("#rebateSet").val();$("#errorRebate").text("");c.RegistChild=true;c.IsAgent=b==1?"true":"false";if(c.Rebate==null||c.Rebate==""){_confirm("warning",0,"","无可选返点，不可注册下级");hide_bet_loadding();return}var a=ctx+"/agentCenter/UserRegist";$("#saveRegister").attr("disabled","disabled");$.post(a,{message:json2str(c)},function(h){$("#saveRegister").removeAttr("disabled");if(h.RegisterComplete==true){OpenAccount.reset();var e="用户名："+c.UserName+"<br>返点："+c.Rebate+"<br>初始密码：a123456<br>平台网址："+bpath+"<br>测速网址："+_line_test_site;var f="<textarea id='copyInfo' readonly='readonly' style='border: 0;outline: none;background-color:transparent;resize: none;min-width:260px;min-height: 120px;'></textarea><div style='border:none; position:absolute;right:10px; top:110px;'><span id='userInfo_copyTips'></span></div>";$("#account_content").html(f);$("#openAccount_msg").modal("show");$("#copyInfo").val(e.replace(/<br>/g,"\n"));copyTxt("userInfo_copy_button","copyInfo",OpenAccount.redirectReg)}else{var g="";if(""!=h.StateMark){g=","+h.StateMark}_confirm("error",0,"","注册失败"+((h.ErrorCode=="3")?"":g))}hide_bet_loadding()},"json")},userInfo_copy_tips:function(){var a=$("<div class='copy-tips'><div class='copy-tips-wrap'>☺ 复制成功</div></div>");$("#userInfo_copyTips").find(".copy-tips").remove().end().append(a);$(".copy-tips").fadeOut(3000)},redirectReg:function(){$(".add_member").modal("hide");$(".modal-backdrop").remove();AgentCenter.memberManage(0);OpenAccount.reset();return},links_generate:function(){var b=$("input[name='lowerType_link']:checked").val();var c={};c.TeamName=encodeURIComponent($("#teamname").val());c.QQ=$("#qq").val();c.Rebate=$("#rebateSet_link").val();$("#errorRebate").text("");c.IsAgent=b==1?"true":"false";if(c.Rebate==null||c.Rebate==""){_confirm("warning",0,"","无可选返点，不可注册下级");return}var a=ctx+"/agentCenter/getUserRegistUrlList";$.post(a,function(d){if(d.SystemState=="64"){_dataCount=d.DataCount;if(_dataCount>=10){_confirm("warning",0,"","注册链接最多可添加10条，请先处理闲置链接",function(){_loadPage(".swithBox .swithBox01",ctx+"/agentCenter/openAccountLinks");return},function(){_loadPage(".swithBox .swithBox01",ctx+"/agentCenter/openAccountLinks");return});return false}else{OpenAccount.addUserRegistUrl(c)}}},"json")},addUserRegistUrl:function(b){var a=ctx+"/agentCenter/addUserRegistUrl";$.post(a,{message:json2str(b)},function(d){if(d.CompleteStatus){_registUrlCode=d.RegistUrlCode;var c=ctx+"/agentCenter/getShortLink";$.post(c,{urlCode:_registUrlCode},function(e){OpenAccount.reset();$("#_regist_url_copy_val").val(e);copyTxt("_regist_url_copy_button","_regist_url_copy_val",OpenAccount._copy_tips);$("#teamname").val("");$("#qq").val("");$("#rebateSet").find("option:first").prop("selected","selected");$("#errorTeamname").text("*").css("color","red");$("#errorQQ").text("*").css("color","red")})}},"json")},_copy_tips:function(){var a=$("<span class='copy-tips' style='margin-left:10px;'>☺ 复制成功</span>");$("#_regist_url_copyTips").find(".copy-tips").remove().end().append(a);$(".copy-tips").fadeOut(3000)},reload:function(){_loadPage(".tab-content",ctx+"/agentCenter/openAccountLinks")},linksList:function(){bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");var a=ctx+"/agentCenter/getUserRegistUrlList";$.post(a,function(c){if(c.SystemState=="64"&&c.UserRegistUrlList.length>0){$("#linksListDiv").css("display","block");_dataCount=c.DataCount;var b="";$.each(c.UserRegistUrlList,function(e,g){var f="";if(g.Status==1){urlStyle="color: green"}else{urlStyle="color: #e7e7e7"}b+="<tr urlCode='"+g.RegistUrl+"'><td style='width: 5%;'>"+(e+1)+"</td><td style='width: 10%;'>"+OpenAccount.getUserType(g.UserType)+"</td><td style='width: 10%;'>"+g.Rebate+"</td><td style='width: 20%;'>"+g.CreateTime+"</td><td style='width: 10%;'>"+g.RegisteredNum+"</td><td style='width: 25%;'><input class='cp' type='text' readonly='readonly' style='"+urlStyle+"'class='linkUrl' value='"+g.RegistUrl+"' /></td><td style='width: 20%; position: relative;'>";if(g.Status==1){b+="	<a href='javaScript:void(0);' onclick='OpenAccount.modifyUserRegistUrl(this,"+g.ID+",0);' class='cp'>关闭</a>"}else{b+="	<a href='javaScript:void(0);' onclick='OpenAccount.modifyUserRegistUrl(this,"+g.ID+",1);' class='cp'>开启</a>"}b+="	<a href='javaScript:void(0);' onclick='OpenAccount.copyLinks(this,"+e+");' class='cp'>复制</a>	<a href='javaScript:void(0);' onclick='OpenAccount.deleteUserRegistUrl("+g.ID+");' class='cp'>删除</a><div style='border:none; position:absolute;left:-36px; top:11px;'><span id='links_copyTips_"+e+"'></span></div></td></tr>"});$("#linksListTable").html(b)}else{$("#linksListTable").html("<tr><td colspan='7'>无记录</td></tr>")}hide_bet_loadding()},"json")},getUserType:function(a){if(a==1){return"代理"}else{return"会员"}},copyLinks:function(b,a){var c=$(b).parent().parent().find("td:eq(5)").find("input");c.focus();c.select();document.execCommand("Copy",false,null);c.blur();OpenAccount.links_copytips(a)},links_copytips:function(a){var b=$("<div class='copy-tips'><div class='copy-tips-wrap'>☺ 复制成功</div></div>");$("#links_copyTips_"+a).find(".copy-tips").remove().end().append(b);$(".copy-tips").fadeOut(3000)},deleteUserRegistUrl:function(a){_confirm("question",1,"","您确定删除此链接吗？删除后无法注册下级！",function(){var c={};c.ID=a;var b=ctx+"/agentCenter/deleteUserRegistUrl";$.post(b,{message:json2str(c)},function(d){if(d.CompleteStatus){_confirm("success",0,"","删除成功",OpenAccount.linksList,OpenAccount.linksList)}else{_confirm("error",0,"","删除失败",OpenAccount.linksList,OpenAccount.linksList)}},"json")})},modifyUserRegistUrl:function(b,c,a){_confirm("question",1,"",a==0?"您确定关闭此链接吗？关闭期间无法注册下级！":"您确定开启此链接？",function(){var e={};e.ID=c;e.Status=a;var d=ctx+"/agentCenter/modifyUserRegistUrl";$.post(d,{message:json2str(e)},function(f){if(f.CompleteStatus){_confirm("success",0,"",a==0?"关闭注册链接成功":"开启注册链接成功",OpenAccount.linksList,OpenAccount.linksList)}else{_confirm("success",0,"",a==0?"关闭注册链接失败":"开启注册链接失败",OpenAccount.linksList,OpenAccount.linksList)}},"json")})},userRebateInit:function(b){if(b>=1950){var a=ctx+"/agentCenter/GetAgentsRenbate";$.post(a,function(g){if(g.SystemState=="64"&&g.GetRm.length>0){var f="<table width='50%'>";var d="<tr><td width='100'>返点比例：</td>";var c="<tr><td>配额总数：</td>";var e="<tr><td>剩余配额：</td>";$.each(g.GetRm,function(h,j){if(b>=j.Rebate&&j.Rebate>=1950){d+='<td class="cr">'+j.Rebate+"</td>";c+="<td>"+(j.Capacity==-1?"无限制":j.Capacity)+"</td>";if(j.Capacity>=0){e+="<td>"+(j.Capacity-j.RegisNum)+"</td>"}else{e+="<td>无限制</td>"}}});d+="</tr>";c+="</tr>";e+="</tr></table>";f+=(d+c+e);$("#userRebateTable").html(f)}},"json")}},reset:function(){$("input[name='lowerType']:eq(0)").prop("checked",true);$("input[name='lowerType_link']:eq(0)").prop("checked",true);$("#username_,#teamname,#qq,#_regist_url_copy_val").val("");OpenAccount.rebateSet(1);OpenAccount.referralLinks(1)}};