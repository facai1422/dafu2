AgentMember={isRepeat:false,init:function(){$("#turnAgent").on("click",function(){var a={};a.Type=1;a.UID=$("#UserID").val();$.post(ctx+"/agentCenter/ModifyCategoryInfo",{message:json2str(a)},function(b){if(b.IsComplete){_confirm("success",0,"","该会员转为代理成功!");$("#turnAgent").remove()}else{_confirm("error",0,"","该会员转为代理失败")}},"json")})},personInfoTable:function(d){var e=$.parseJSON(d);var c="";var a,b;$.each(e.LotteryList,function(f,g){a=g.MaxRebate-(merchantMaxRebate-$("#myRebate").val());b=g.MaxRebate-(merchantMaxRebate-$("#Rebate").val());if(a<parseFloat(merchantMinRebate)){a=merchantMinRebate}if(b<parseFloat(merchantMinRebate)){b=merchantMinRebate}c+="<tr>";c+="<td style='width: 40%;'>"+Lottery.getName(g.LotteryCode)+"</td>";c+="<td style='width: 30%;'>"+a+"</td>";c+="<td style='width: 30%;'>"+b+"</td>";c+="</tr>"});$("#personInfoTable").html(c);$("#lowerAccount").text($("#UserName").val());$("#lotterBalance").text($("#LotteryMoney").val())},showDailyWagesSetting:function(b){var c={};c.UserName=b;var a=ctx+"/agentCenter/showDailyWagesSetting";bet_Loadding("加载中，请稍后……","#myTab_Content0 .tab-content");$.post(a,{message:json2str(c)},function(j){if(j.SystemState==64&&j.ShowDailyWages){$("#_dailyWagesSetting").show();var h=Number(accMul(parseFloat(j.MySettlementRatio),100)).toFixed(1);var f=Number(accMul(parseFloat(j.LowerLevelSettlementRatio),100)).toFixed(1);$("#_mySettlementRatio").html(h+"%");$("#_childSettlementRatio").html(f+"%");$("#_childStatus").html(AgentMember.getLowerLevelState(j.LowerLevelState));$("#_status").val(j.LowerLevelState);var g="<option value=''>请选择</option>";for(var e=h;e>f;e=accSub(e,0.1)){g+="<option value="+e+">"+e+"%</option>"}$("#_settlementRatio").html(g)}else{$("#_dailyWagesSetting").hide()}hide_bet_loadding()},"json")},getLowerLevelState:function(a){if(a==1){return"开启"}else{return"关闭"}},addDailyWagesSetting:function(b){var c={};c.UserName=b;c.SettlementRatio=$("#_settlementRatio").val();c.Status=$("#_status").val();if(c.SettlementRatio==""||c.SettlementRatio==null){_confirm("warning",0,"","请设置日结比例");return}c.SettlementRatio=accDiv(c.SettlementRatio,100);var a=ctx+"/agentCenter/addDailyWagesSetting";$.post(a,{message:json2str(c)},function(d){if(d.SystemState=="64"&&d.ResultState){_confirm("success",0,"","设置成功");AgentMember.showDailyWagesSetting(b);$("#_settlementRatio").val("");$("#_status").val("")}else{_confirm("error",0,"",d.StateMark)}},"json")},personInfo_AccountDetail:function(b){var c={};c.insertTimeMin=$("#starttime_2").val()+" 00:00:00";c.insertTimeMax=$("#endtime_2").val()+" 23:59:59";c.UserID=$("#UserID").val();c.IsHistory=false;if($("#selectTime_2").val()==0){c.IsHistory=true}c.Source=$("#tradeType_2").val();c.ThisUserName=$("#UserName").val();c.CurrentPageIndex=b;c.CurrentPageSize=10;var a=ctx+"/agentCenter/dailyWagesGetUserFundList";bet_Loadding("加载中，请稍后……","#bet_table");$.post(a,{message:json2str(c)},function(e){if(e.SystemState=="64"){$("#personInfo_AccountRecordTable tr:gt(0)").empty();var d="";if(e.UfInfo.length>0){$.each(e.UfInfo,function(f,g){d+="<tr >";if(g.DetailsSource==1||g.DetailsSource==11||g.DetailsSource==12||g.DetailsSource==30||g.DetailsSource==40||g.DetailsSource==50||g.DetailsSource==60||g.DetailsSource==10){d+='<td><a class="cb" onclick="goBettingDetail(\''+g.OrderID+"','0','"+c.IsHistory+"','','#_mainDiv.inner','#myModal_orderDetail');\" data-toggle=\"tooltip\" title="+g.OrderID+">"+g.OrderID+"</a></td>"}else{d+="<td>"+g.OrderID+"</td>"}if(g.DetailsSource==257&&g.UseMoney==0){d+="<td>"+g.Marks+"</td>"}else{d+="<td>"+g.UseMoney+"</td>"}d+="<td>"+g.ThenBalance+"</td>";if(g.DetailsSource==150){d+="<td>"+g.PayTypeName+"</td>"}else{d+="<td>"+sourceType(g.DetailsSource,g.RechargeType)+"</td>"}d+="<td>"+g.InsertTime+"</td>";d+="<td data-toggle='tooltip' title='"+getMarks(g.DetailsSource,g.Marks)+"'>"+getScreen(getMarks(g.DetailsSource,g.Marks),6,10)+"</td>";d+="</tr>"})}$("#personInfo_AccountRecordTable").append(d)}$.page(b,e.DataCount,"personInfo_AccountRecordTable",6);hide_bet_loadding()},"json")},personInfo_betRecord:function(b){var c={};c.insertTimeMin=$("#starttime_3").val()+" 00:00:00";c.insertTimeMax=$("#endtime_3").val()+" 23:59:59";c.SourceCode=1;c.LotteryCode=$("#lotteryType_3").val();c.UserID=$("#UserID").val();c.ThisUserName=$("#UserName").val();c.IsHistory=false;if($("#selectTime_3").val()==0){c.IsHistory=true}c.CurrentPageIndex=b;c.CurrentPageSize=10;var a=ctx+"/agentCenter/GetBetDataListFlex";bet_Loadding("加载中，请稍后……","#manage_02");$.post(a,{message:json2str(c)},function(f){$("#bet_table #_sumInfo").hide();if(f.SystemState=="64"){$("#personInfo_betRecordTable tr:gt(0)").empty();var e="";if(f.BtInfo.length>0){var d=f.IsHistory;$.each(f.BtInfo,function(g,h){e+="<tr LotteryCode='"+h.BetTb+"' ChaseOrderID='"+h.ChaseOrderID+"' OrderID='"+h.OrderID+"'>";e+="<td><a style='color:#FF0000;' href='javascript:void(0)' onclick='AgentMember.betRecordDetail(this,"+d+")' >"+h.ChaseOrderID+"</a></td>";e+="<td>"+Lottery.getName(h.BetTb)+"</td>";e+="<td>"+h.IssueNumber+"</td>";e+="<td>"+h.BetMoney+"</td>";e+="<td>"+h.AwardMoney+"</td>";e+="<td>"+Lottery.viewOrderState(h.OrderState)+"</td>";e+="<td>"+h.InsertTime+"</td>";e+="<td><a href='javascript:void(0)' style='color:#FF0000;' onclick='AgentMember.betRecordDetail(this,"+d+")' >查看</a></td>";e+="</tr>"});$("#bet_table #_sumInfo").show();$("#bet_table #_sumInfo").html("投注总金额："+f.BetsSumMoney+" 元")}$("#personInfo_betRecordTable").append(e)}$.page(b,f.DataCount,"personInfo_betRecordTable",8,20);hide_bet_loadding()},"json")},betRecordDetail:function(e,a){$("#myModal_agent_orderDetail").modal("show");var b=$(e).parent().parent().attr("lotterycode");var f=$(e).parent().parent().attr("chaseorderid");var d=$(e).parent().parent().attr("orderid");var e={};e.LotteryCode=b;e.OrderID=d;e.IsHistory=a;var c=ctx+"/agentCenter/GetBetOrderDetil";$.post(c,{message:json2str(e)},function(i){var h=i.UserBetInfo.Bet;if(h.length>0){var g;$.each(h,function(k,m){if(h[k].OrderID==d){var l=h[k];$("#_agent_betDetailTable").find("tr:eq(0)").find("td:eq(1)").text(l.ChaseOrderID);$("#_agent_betDetailTable").find("tr:eq(0)").find("td:eq(3)").text(getMode(l.BetMode,l.PlayCode));$("#_agent_betDetailTable").find("tr:eq(1)").find("td:eq(1)").text(l.OrderID);$("#_agent_betDetailTable").find("tr:eq(1)").find("td:eq(3)").text(getRebate(i.UserBetInfo.BetRebate,l.PlayCode));$("#_agent_betDetailTable").find("tr:eq(2)").find("td:eq(1)").text(Lottery.getName(i.UserBetInfo.LotteryCode));$("#_agent_betDetailTable").find("tr:eq(2)").find("td:eq(3)").text(l.InsertTime);$("#_agent_betDetailTable").find("tr:eq(3)").find("td:eq(1)").text(Lottery.getName(i.UserBetInfo.LotteryCode,l.PlayCode,Lottery.mode(l.BetMode)));if(""==l.DrawContent){g="等待开奖"}else{if(i.UserBetInfo.LotteryCode==9||i.UserBetInfo.LotteryCode==79||i.UserBetInfo.LotteryCode==80){g=l.DrawContent.substring(0,(l.DrawContent).lastIndexOf(","))}else{g=l.DrawContent}}$("#_agent_betDetailTable").find("tr:eq(3)").find("td:eq(3)").text(g);var j=l.BetContent;if((l.BetMode&8)!=8&&(l.BetMode&16)!=16){$("#searchBetDetail_agent").hide();$("#_agent_sub_betContent").parent().show();j=getBetContent(l.PlayCode,l.BetContent,Lottery.mode(l.BetMode),i.UserBetInfo.LotteryCode);$("#_agent_sub_betContent").val(j)}else{if(l.BetCount<10000){$("#searchBetDetail_agent").hide();$("#_agent_sub_betContent").parent().show();j=getBetContent(l.PlayCode,l.BetContent,Lottery.mode(l.BetMode),i.UserBetInfo.LotteryCode);$("#_agent_sub_betContent").val(j)}else{$("#_agent_sub_betContent").parent().hide();$("#searchBetDetail_agent").show()}}$("#_agent_betDetailTableList").find("tr:eq(1)").find("td:eq(0)").text(l.IssueNumber);$("#_agent_betDetailTableList").find("tr:eq(1)").find("td:eq(1)").text(getMultiple(l.BetMultiple,l.PlayCode));$("#_agent_betDetailTableList").find("tr:eq(1)").find("td:eq(2)").text(l.BetCount);$("#_agent_betDetailTableList").find("tr:eq(1)").find("td:eq(3)").text(l.BetMoney);$("#_agent_betDetailTableList").find("tr:eq(1)").find("td:eq(4)").html(betOrderState(l.BetOrderState));$("#_agent_betDetailTableList").find("tr:eq(1)").find("td:eq(5)").text(""==l.AwContent?"0":l.AwContent);$("#_agent_betDetailTableList").find("tr:eq(1)").find("td:eq(6)").text(l.AwMoney)}$("#bet_detail").on("shown.bs.modal",function(n){j=getBetContent(l.PlayCode,l.BetContent,Lottery.mode(l.BetMode),i.UserBetInfo.LotteryCode);$("#bet_content_detail").val(j)})})}copyTxt("_agent_sub_bet_copy","_agent_sub_betContent",AgentMember.sub_add_tips);copyTxt("bet_content_copy","bet_content_detail",function(){$("#bet_detail").modal("hide")})},"json")},sub_add_tips:function(){var a=$("<div class='copy-tips'><div class='copy-tips-wrap'>☺ 复制成功</div></div>");$("#sub_copyTips").find(".copy-tips").remove().end().append(a);$(".copy-tips").fadeOut(3000)},checkMoney:function(a){$("#"+a).keyup(function(){var c=$(this).val().match(/\d+\.?\d{0,2}/);var b="";if(c!=null){b=c[0]}$(this).val(b)}).change(function(){$(this).keypress();var b=$(this).val();if(/\.$/.test(b)){$(this).val(b.substr(0,b.length-1))}})},personInfo_recharge:function(){if(AgentMember.isRepeat){return false}AgentMember.isRepeat=true;setTimeout($.proxy(function(){this.isRepeat=false},this),1000);var b=$("#lotterBalance").text();if(isNull($("#lowerBalance").val())){_confirm("warning",0,"","请输入充值金额");return}else{if(!isMoney($("#lowerBalance").val())){return}else{if($("#lowerBalance").val()<1||$("#lowerBalance").val()>50000){_confirm("warning",0,"","请输入正确的金额,范围（1-50000）");return}else{if($("#lowerBalance").val()>Number(b)){_confirm("warning",0,"","您的彩票余额不足");return}}}}if($.trim($("#password").val())==""){_confirm("warning",0,"","请输入资金密码");return}if($("#remark").val()==4){if($.trim($("#other").val())==""){_confirm("warning",0,"","类型为“其他”时，必须手动填写备注");return}else{if($.trim($("#other").val()).length>10){_confirm("warning",0,"","备注最多10个字符");return}}}var c={};c.TargetUserID=$("#UserID").val();c.TransferMoney=$("#lowerBalance").val();c.TargetUserName=$("#UserName").val();c.Password=$("#password").val();c.Mark=$("#remark").val()==4?$("#other").val():$("#remark").val();if(c.Mark==5){AgentMember.dailyWagesTransefer();return}var a=ctx+"/agentCenter/AddTransferInfo_LotteryTransfer";bet_Loadding("加载中，请稍后……","#bet_table");$("#_child_transfer").attr("disabled","disabled");$.post(a,{message:json2str(c)},function(d){if(d.SystemState=="64"&&d.StateResult){$.post(ctx+"/GetUserAllMoney",function(e){if(e.state){$("#lotterBalance").text(e.lotteryMoney)}},"json");_confirm("success",0,"","充值成功");AgentMember.initInput()}else{if(d.ErrorState=="2"){_confirm("error",0,"","资金密码错误")}else{if(d.ErrorState=="-6"){_confirm("warning",0,"","sorry,您还没有完成与下级的分红契约，无法给下级转账",redirectBonus)}else{_confirm("error",0,"",d.StateMark)}}}$("#_child_transfer").removeAttr("disabled");hide_bet_loadding()},"json")},dailyWagesTransefer:function(){var c={};c.ToUserID=$("#UserID").val();c.UserName=$("#ParentName").val();c.ToUserName=$("#UserName").val();c.DailyWages=$("#lowerBalance").val();c.Password=$("#password").val();c.Mark="日工资";var b=$("#lotterBalance").text();if(isNull($("#lowerBalance").val())){_confirm("warning",0,"","请输入充值金额");return}else{if(!isMoney($("#lowerBalance").val())){return}else{if($("#lowerBalance").val()>Number(b)){_confirm("warning",0,"","您的彩票余额不足");return}}}if($.trim($("#password").val())==""){_confirm("warning",0,"","请输入资金密码");return}var a=ctx+"/agentCenter/dailyWagesTransefer";$.post(a,{message:json2str(c)},function(d){if(d.SystemState=="64"&&d.StateResult){$.post(ctx+"/GetUserAllMoney",function(e){if(e.state){$("#lotterBalance").text(e.lotteryMoney)}},"json");_confirm("success",0,"","充值成功");AgentMember.initInput()}else{if(d.SystemState=="128"&&d.StateMark==null){_confirm("error",0,"","系统繁忙,请稍后重试")}else{if(d.ErrorState=="2"){_confirm("error",0,"","资金密码错误")}else{if(d.ErrorState=="-6"){_confirm("warning",0,"","sorry,您还没有完成与下级的分红契约，无法给下级转账",redirectBonus)}else{_confirm("error",0,"",d.StateMark)}}}}},"json")},initInput:function(){$(".sum").removeClass("active");$("#tradeType_2").val(0);$("#selectTime_2").val(1);mySelectTime("3","selectTime_2","starttime_2","endtime_2");$("#selectTime_3").val(1);mySelectTime("3","selectTime_3","starttime_3","endtime_3");$("#lowerBalance").val("");$("#password").val("");$("#other").hide();$("#other").val("");$("#remark").val("转账")},saveUpgrade:function(){if($("#upGradeRebate").val()==0){_confirm("warning",0,"","请选择返点");return}var b={};b.ThisUserID=$("#UserID").val();b.Rebate=$("#upGradeRebate").val();var a=ctx+"/agentCenter/SetUserRebate";$("#_saveUpgrade").attr("disabled","disabled");$.post(a,{message:json2str(b)},function(d){if(d.SystemState=="64"&&d.RegisterComplete){var c=[];$.each($("#upGradeRebate").find("option"),function(e,f){if($(this).val()>$("#upGradeRebate").val()){c.push($(this).val())}});$("#upGradeRebate").find("option:gt(0)").remove();$("#Parentrebate").val(c.join(","));$("#num").val(1);$("#Rebate").val(Number(b.Rebate));AgentMember.initUpGrade();_confirm("success",0,"","升级成功",function(){$("#upGrade").modal("hide")});AgentCenter.memberManage(0)}else{if(d.OrderState==-3){_confirm("error",0,"","该返点注册人数已满")}else{_confirm("error",0,"","升级失败")}}$("#_saveUpgrade").removeAttr("disabled")},"json")},initUpGrade:function(){$("#_saveUpgrade").removeAttr("disabled");var e=personObj.UserLevel;var b=$("#Parentrebate").val();var d=Number($("#Rebate").val())+2;var a=Number(personObj.MyRebate);$("#upGradeRebate").find("option:gt(0)").remove();var f=b.split(",");for(var c=a;c>=d;c-=2){if(f.in_array(c)){$("#upGradeRebate").append("<option value="+c+">"+c+"</option>")}}if($("#upGradeRebate").find("option").size()<=1){$("#_saveUpgrade").attr("disabled","disabled")}},getLotterBalance:function(){var a=ctx+"/financeCenter/getUserAllMoney";$.post(a,function(b){if(b.state){$("#lotterBalance").text(b.lotteryMoney)}else{$("#lotterBalance").text("0.00")}},"json")}};